<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learning Manager â€“ Public Search Filters</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #f5f5f7;
    margin: 0;
    display: flex;
    height: 100vh;
  }

  /* Left filter panel */
  #filters {
    width: 320px;
    background: #fff;
    border-right: 1px solid #e0e0e0;
    padding: 20px;
    overflow-y: auto;
  }
  #filters h2 {
    font-size: 1.2rem;
    margin-bottom: 10px;
    color: #1d1d1f;
  }
  details {
    margin-bottom: 15px;
  }
  summary {
    font-weight: 600;
    cursor: pointer;
    color: #0071e3;
    margin-bottom: 5px;
  }
  label {
    display: block;
    margin-left: 15px;
    margin-bottom: 4px;
    font-size: 0.9rem;
  }
  input[type="checkbox"] {
    margin-right: 8px;
  }
  button {
    background-color: #0071e3;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    font-size: 0.95rem;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
    transition: all 0.2s ease;
  }
  button:hover {
    background-color: #005bb5;
  }

  /* Right results section */
  #results {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
  }
  #results h2 {
    margin-top: 0;
    color: #1d1d1f;
  }

  .card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    padding: 20px;
    margin-bottom: 15px;
    transition: transform 0.2s ease;
  }
  .card:hover {
    transform: translateY(-3px);
  }
  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #111;
    margin-bottom: 5px;
  }
  .card-detail {
    font-size: 0.9rem;
    color: #555;
  }
  .loader {
    text-align: center;
    margin-top: 30px;
    color: #0071e3;
    font-weight: 500;
  }
</style>
</head>
<body>

<!-- Left: Filters -->
<div id="filters">
  <h2>Filter Options</h2>
  <div id="filterContainer"></div>
  <button id="applyFilter">Apply Filter</button>
</div>

<!-- Right: Results -->
<div id="results">
  <h2>Search Results</h2>
  <div id="cardsContainer">No results yet. Apply filters to search.</div>
</div>

<script>
/* ====== Public Search Filter Data ====== */
const filterableData = {
  "terms": {
    "loSkillLevels": ["1","2","3"],
    "catalogNames": ["AnupamCAT","Cat courses","eff LPs","Category B Learning objects","TESTY","CATALOG 101","CAT111 Vix","TESTStock","Harvard ManageMentor","WASA","Category A Learning objects","DELHI","Default Catalog","TEST","Anup2Raji","GET THE JOBS","RUSSIA","CAT_FOR_LP_TEST","Catalog Demo","TEST1"],
    "loType": ["course","learningProgram","certification"],
    "cities": ["Adobe Bangalore 101","Adobe Bangaloree Blr","Blr"],
    "deliveryType": ["Self Paced","Classroom","Blended","Activity","Virtual Classroom"],
    "loSkillNames": ["SKILL_three","Art","SKILL_one","LP SKILLS","Chemist","Pilot Vix","Migration Skill","Java Programming","After Effects**","LMS Basics","Mastering Illustrator","Lightroom","After Effects","After Effects*","Lightroom*","SKILL _two","CryptoGraphy","SKILL A","Onboarded","TEST1","Vector Illustrator","C.skill","Data analysis","skill Name1","Anupam's admin trial","Dpom","IT","skill Name2","skill Name3","Gamification","TEST SKILL C1","SKILL_105","SKILL_four","General","SKILL_103","Photoshop","SKILL_104","SKILL_101","SKILL_102"],
    "catalogLabelIds": ["1497_6246","1497_3751","4210_10670"],
    "tags": ["TER","ALM","RSSR","Cardiac Diagnostic","Diagnostic","mig","Tag1","Catalog ABC","MultiEnrollmentEnabled","Toon","Tag3","Tag2","tg1","spanish","KCheck","tagw1","test","Keyword","anup","tg11","anu","Multi Enrollment Enabled","Q2-2024","MyTags","ALM1","Q2-2025","1","TR1","ppt","YourTags","TR","anupam"],
    "averageRating": ["0.0","2.0","3.0","4.0","5.0"],
    "ratingsCount": ["0","1","2","3"]
  }
};

/* ====== Build Filter UI ====== */
const filterContainer = document.getElementById("filterContainer");
for (const [category, values] of Object.entries(filterableData.terms)) {
  const details = document.createElement("details");
  const summary = document.createElement("summary");
  summary.textContent = category;
  details.appendChild(summary);

  values.forEach(value => {
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = category;
    checkbox.value = value;
    label.appendChild(checkbox);
    label.append(value);
    details.appendChild(label);
  });
  filterContainer.appendChild(details);
}

/* ====== Fetch Learning Objects ====== */
const baseUrl = "https://primeapps.adobe.com/almsearch/api/v1/production/108079/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/search?size=50";

document.getElementById("applyFilter").addEventListener("click", async () => {
  const selectedFilters = {};
  document.querySelectorAll('#filters input[type="checkbox"]:checked').forEach(cb => {
    if (!selectedFilters[cb.name]) selectedFilters[cb.name] = [];
    selectedFilters[cb.name].push(cb.value);
  });

  const payload = {
    query: "",
    filters: { terms: selectedFilters }
  };

  const container = document.getElementById("cardsContainer");
  container.innerHTML = '<div class="loader">Loading results...</div>';

  try {
    const response = await fetch(baseUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!response.ok) throw new Error("HTTP " + response.status);
    const data = await response.json();

    const results = data?.hits?.hits || [];
    if (results.length === 0) {
      container.textContent = "No results found for selected filters.";
      return;
    }

    container.innerHTML = "";
    results.forEach(hit => {
      const item = hit._source;
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="card-title">${item.name}</div>
        <div class="card-detail">Type: ${item.loType || "N/A"}</div>
        <div class="card-detail">Delivery: ${item.deliveryType || "N/A"}</div>
        <div class="card-detail">Duration: ${item.duration || "N/A"} mins</div>
        <div class="card-detail">Catalogs: ${item.catalogNames?.join(", ") || "N/A"}</div>
        <div class="card-detail">Skills: ${item.skillNames?.join(", ") || "N/A"}</div>
        <div class="card-detail">Rating: ${item.averageRating || "N/A"}</div>
      `;
      container.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    container.textContent = "Error fetching results. Check console for details.";
  }
});
</script>
</body>
</html>
