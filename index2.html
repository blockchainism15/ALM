<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALM Learning Objects Filter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      margin: 0;
      padding: 0;
    }
    #filterPanel {
      width: 250px;
      padding: 20px;
      border-right: 1px solid #ccc;
      height: 100vh;
      overflow-y: auto;
      background-color: #f9f9f9;
    }
    #resultsPanel {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    select {
      width: 100%;
      margin-bottom: 15px;
      padding: 5px;
    }
    .badge {
      display: inline-block;
      background-color: #007bff;
      color: #fff;
      padding: 5px 10px;
      margin: 3px;
      border-radius: 3px;
      cursor: pointer;
    }
    .badge:hover {
      background-color: #0056b3;
    }
    .loCard {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
    }
    .loCard h3 {
      margin: 0 0 10px 0;
    }
    .loCard p {
      margin: 5px 0;
    }
  </style>
</head>
<body>

  <div id="filterPanel">
    <h3>Filters</h3>

    <label>Catalogs</label>
    <select id="catalogNames" multiple></select>
    <div id="catalogBadges"></div>

    <label>Learning Object Type</label>
    <select id="loType" multiple></select>
    <div id="typeBadges"></div>

    <label>Delivery Type</label>
    <select id="deliveryType" multiple></select>
    <div id="deliveryBadges"></div>

    <label>Skill Levels</label>
    <select id="loSkillLevels" multiple></select>
    <div id="levelBadges"></div>

    <label>Skills</label>
    <select id="loSkillNames" multiple></select>
    <div id="skillBadges"></div>
  </div>

  <div id="resultsPanel">
    <h3>Search Results</h3>
    <div id="results"></div>
  </div>

  <script>
    const filtersData = {
      loType: ["course", "learningProgram", "certification"],
      deliveryType: ["Self Paced", "Classroom", "Blended", "Activity", "Virtual Classroom"],
      loSkillLevels: ["1", "2", "3"],
      loSkillNames: [
        "SKILL_three","Art","SKILL_one","LP SKILLS","Chemist","Pilot Vix","Migration Skill","Java Programming",
        "After Effects**","LMS Basics","Mastering Illustrator","Lightroom","After Effects","After Effects*",
        "Lightroom*","SKILL _two","CryptoGraphy","SKILL A","Onboarded","TEST1","Vector Illustrator",
        "C.skill","Data analysis","skill Name1","Anupam's admin trial","Dpom","IT","skill Name2",
        "skill Name3","Gamification","TEST SKILL C1","SKILL_105","SKILL_four","General","SKILL_103",
        "Photoshop","SKILL_104","SKILL_101","SKILL_102"
      ],
      catalogNames: [
        "AnupamCAT","Cat courses","eff LPs","Category B Learning objects","TESTY","CATALOG 101","CAT111 Vix",
        "TESTStock","Harvard ManageMentor","WASA","Category A Learning objects","DELHI","Default Catalog",
        "TEST","Anup2Raji","GET THE JOBS","RUSSIA","CAT_FOR_LP_TEST","Catalog Demo","TEST1"
      ]
    };

    const badgeMap = {
      catalogNames: 'catalogBadges',
      loType: 'typeBadges',
      deliveryType: 'deliveryBadges',
      loSkillLevels: 'levelBadges',
      loSkillNames: 'skillBadges'
    };

    // Populate all selects
    for (let key in filtersData) {
      const select = document.getElementById(key);
      filtersData[key].forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    }

    function renderBadges(selectId, badgeContainerId) {
      const select = document.getElementById(selectId);
      const container = document.getElementById(badgeContainerId);
      container.innerHTML = '';
      Array.from(select.selectedOptions).forEach(opt => {
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.innerText = opt.value;
        badge.addEventListener('click', () => {
          opt.selected = false;
          renderBadges(selectId, badgeContainerId);
          fetchData();
        });
        container.appendChild(badge);
      });
    }

    // Add event listeners to all filters
    Object.keys(badgeMap).forEach(id => {
      document.getElementById(id).addEventListener('change', () => {
        renderBadges(id, badgeMap[id]);
        fetchData();
      });
    });

    async function fetchData() {
      const filters = { terms: {} };
      for (let key in badgeMap) {
        const select = document.getElementById(key);
        const selected = Array.from(select.selectedOptions).map(opt => opt.value);
        if (selected.length > 0) filters.terms[key] = selected;
      }

      const url = "https://primeapps.adobe.com/almsearch/api/v1/production/108079/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/search?size=1000";

      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Origin': window.location.origin
          },
          body: JSON.stringify({
            query: "",
            filters: filters
          })
        });

        if (!res.ok) throw new Error('Network response was not ok');
        const data = await res.json();
        displayResults(data.results);
      } catch (err) {
        document.getElementById('results').innerHTML = '<p style="color:red;">Error fetching data: ' + err + '</p>';
      }
    }

    function displayResults(results) {
      const container = document.getElementById('results');
      container.innerHTML = '';

      if (!results || results.length === 0) {
        container.innerHTML = '<p>No results found for selected filters.</p>';
        return;
      }

      results.forEach(lo => {
        const card = document.createElement('div');
        card.className = 'loCard';
        card.innerHTML = `
          <h3>${lo.name} (${lo.loType})</h3>
          <p><strong>Status:</strong> ${lo.status}</p>
          <p><strong>Delivery Type:</strong> ${lo.deliveryType}</p>
          <p><strong>Duration:</strong> ${lo.duration} mins</p>
          ${lo.authors ? `<p><strong>Authors:</strong> ${lo.authors.join(', ')}</p>` : ''}
          ${lo.description ? `<p><strong>Description:</strong> ${lo.description}</p>` : ''}
          ${lo.loSkillNames.length ? `<p><strong>Skills:</strong> ${lo.loSkillNames.join(', ')}</p>` : ''}
          <p><strong>Catalogs:</strong> ${lo.catalogInfo.map(c => c.name).join(', ')}</p>
        `;
        container.appendChild(card);
      });
    }

    // Initial fetch
    fetchData();

  </script>
</body>
</html>
