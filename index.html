<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adobe Learning Manager Courses</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f5f7;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background: #000;
      color: #fff;
      text-align: center;
      padding: 20px 10px;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 1px;
    }

    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }

    .course-tile {
      background: #fff;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .course-tile:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
    }

    .course-tile h3 {
      margin: 0 0 10px;
      font-size: 1.2rem;
      color: #111;
    }

    .course-tile p {
      margin: 4px 0;
      color: #555;
    }

    .loading {
      text-align: center;
      font-size: 1.1rem;
      color: #666;
      margin-top: 40px;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #666;
      font-size: 0.9rem;
      margin-top: 50px;
      border-top: 1px solid #ddd;
    }

    /* === Modal Styling === */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(6px);
      background: rgba(0, 0, 0, 0.4);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.4s ease;
      overflow-y: auto;
      max-height: 80vh;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 25px;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 18px;
      transition: background 0.2s ease;
    }

    .close-btn:hover {
      background: #d32f2f;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <header>ðŸŽ“ Adobe Learning Manager Courses</header>

  <main>
    <div id="courses-container" class="course-grid"></div>
    <div id="loading" class="loading">Loading courses...</div>
  </main>

  <footer>Powered by Adobe Learning Manager Non-Logged-In APIs</footer>

  <!-- Modal -->
  <div id="courseModal" class="modal">
    <div class="modal-content" id="modalContent">
      <button class="close-btn" id="closeModal">&times;</button>
      <div id="modalBody">Loading...</div>
    </div>
  </div>

  <script>
    const searchBaseURL = "https://primeapps.adobe.com/almsearch/api/v1/production/108079/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8";
    const cdnBaseURL = "https://cpcontents.adobe.com/public/guest/production/api/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/108079";

    const modal = document.getElementById("courseModal");
    const modalBody = document.getElementById("modalBody");
    const closeModal = document.getElementById("closeModal");

    closeModal.onclick = () => (modal.style.display = "none");
    window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

    async function fetchCourses() {
      try {
        const response = await fetch(`${searchBaseURL}/search`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            query: "",
            filters: { terms: { loType: ["course"] } },
            size: 12,
            lang: ["en-US"]
          }),
        });

        const data = await response.json();
        const results = data.results || [];

        document.getElementById("loading").style.display = "none";
        displayCourseTiles(results);
      } catch (error) {
        console.error("Error fetching courses:", error);
        document.getElementById("loading").innerText = "Failed to load courses.";
      }
    }

    function displayCourseTiles(courses) {
      const container = document.getElementById("courses-container");
      container.innerHTML = "";

      courses.forEach(course => {
        const name = course.name || "Untitled Course";
        const authors = course.authorNames?.join(", ") || "Unknown Author";
        const duration = course.duration ? `${Math.round(course.duration / 60)} mins` : "N/A";

        const tile = document.createElement("div");
        tile.className = "course-tile";
        tile.innerHTML = `
          <h3>${name}</h3>
          <p><strong>Author:</strong> ${authors}</p>
          <p><strong>Duration:</strong> ${duration}</p>
        `;
        tile.addEventListener("click", () => showCourseDetails(course.id, name));
        container.appendChild(tile);
      });
    }

    async function showCourseDetails(courseId, courseName) {
      modal.style.display = "flex";
      modalBody.innerHTML = `<p>Loading details for <strong>${courseName}</strong>...</p>`;

      try {
        const response = await fetch(`${cdnBaseURL}/course/${courseId}.json`);
        const json = await response.json();
        const courseData = json.data?.attributes || {};
        const localized = courseData.localizedMetadata?.[0] || {};
        const author = courseData.authorNames?.join(", ") || "Unknown";
        const duration = courseData.duration ? `${Math.round(courseData.duration / 60)} mins` : "N/A";

        let html = `
          <h2>${localized.name}</h2>
          <p>${localized.description || "No description available."}</p>
          <p><strong>Author:</strong> ${author}</p>
          <p><strong>Duration:</strong> ${duration}</p>
        `;

        if (json.included) {
          const modules = json.included
            .filter(item => item.type === "learningObjectResource")
            .map(item => `<li>${item.attributes.name}</li>`)
            .join("");

          html += `
            <h3>Modules</h3>
            <ul>${modules || "<li>No modules found.</li>"}</ul>
          `;
        }

        modalBody.innerHTML = html;
      } catch (error) {
        console.error("Error fetching details:", error);
        modalBody.innerHTML = "<p>Failed to load course details.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", fetchCourses);
  </script>
</body>
</html>
