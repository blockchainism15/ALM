<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Adobe Learning Manager - Learning Objects</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    background-color: #f5f5f7;
    margin: 0;
    padding: 20px;
    color: #333;
  }

  header {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    text-align: center;
    font-size: 1.8em;
    font-weight: 600;
    color: #1d1d1f;
    margin-bottom: 30px;
  }

  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: flex-end;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 16px;
    padding: 15px 20px;
    margin-bottom: 25px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }

  .filter-group {
    display: flex;
    flex-direction: column;
  }

  .filter-group label {
    font-weight: 600;
    color: #1d1d1f;
    margin-bottom: 5px;
  }

  .filter-group select {
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    background: white;
    font-size: 0.95em;
  }

  .filter-actions {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
  }

  .filter-actions button {
    padding: 10px 20px;
    border-radius: 12px;
    border: none;
    background: #0071e3;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-actions button:hover {
    background: transparent;
    border: 1px solid #0071e3;
    color: #0071e3;
  }

  .results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .card {
    background: white;
    border-radius: 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.25s ease;
    display: flex;
    flex-direction: column;
  }

  .card:hover {
    transform: scale(1.03);
  }

  .card-img {
    width: 100%;
    height: 160px;
    object-fit: cover;
  }

  .card-content {
    padding: 15px;
    flex-grow: 1;
  }

  .card-content h3 {
    margin: 0 0 8px;
    font-size: 1.1em;
    color: #1d1d1f;
  }

  .card-content p {
    font-size: 0.9em;
    color: #555;
    line-height: 1.4em;
  }

  footer {
    text-align: center;
    margin-top: 40px;
    color: #888;
    font-size: 0.9em;
  }
</style>
</head>
<body>
  <header>Adobe Learning Manager - Learning Objects</header>

  <section class="filters">
    <div>Loading filters...</div>
  </section>

  <section class="results">
    <div>Loading courses...</div>
  </section>

  <footer>Â© 2025 Adobe Learning Manager Integration</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  loadFilters();
  loadAllCourses();
});

// ---------------------
// Load filters section
// ---------------------
async function loadFilters() {
  const filterUrl = "https://primeapps.adobe.com/almsearch/api/v1/eu/9759/5fc01dd5-de45-408d-9b07-b267d40ebef9/filterableData";
  const filterSection = document.querySelector(".filters");
  filterSection.innerHTML = "<div>Loading filters...</div>";

  try {
    const response = await fetch(filterUrl);
    if (!response.ok) throw new Error("Failed to fetch filters");
    const data = await response.json();

    const { terms, range } = data;
    if (!terms && !range) throw new Error("No filters found");

    let html = `<form id="filterForm" class="filter-form">`;

    // --- Build dropdowns for each term ---
    for (const key in terms) {
      const values = terms[key];
      if (Array.isArray(values) && values.length > 0) {
        html += `
        <div class="filter-group">
          <label>${key}</label>
          <select name="${key}">
            <option value="">All</option>
            ${values.map(v => `<option value="${v}">${v}</option>`).join("")}
          </select>
        </div>`;
      }
    }

    html += `
      <div class="filter-actions">
        <button type="button" id="applyFiltersBtn">Apply Filters</button>
      </div>
    </form>`;

    filterSection.innerHTML = html;

    // Attach click listener to Apply button
    document.getElementById("applyFiltersBtn").addEventListener("click", applyFilters);

  } catch (err) {
    console.error(err);
    filterSection.innerHTML = `<div style="color:red;">Failed to load filters</div>`;
  }
}

// ---------------------
// Apply filters & fetch results
// ---------------------
async function applyFilters() {
  const form = document.getElementById("filterForm");
  const selected = {};

  // Collect selected values
  for (const el of form.elements) {
    if (el.tagName === "SELECT" && el.value) {
      selected[el.name] = el.value;
    }
  }

  // Build query parameters
  const params = new URLSearchParams(selected).toString();

  // Construct filtered API URL
  const searchUrl = `https://primeapps.adobe.com/almsearch/api/v1/eu/9759/5fc01dd5-de45-408d-9b07-b267d40ebef9/search?${params}`;
  const resultsSection = document.querySelector(".results");
  resultsSection.innerHTML = "<div>Loading filtered results...</div>";

  try {
    const response = await fetch(searchUrl);
    if (!response.ok) throw new Error("Failed to fetch search results");
    const data = await response.json();

    const items = data.hits || data.learningObjects || [];
    if (!items.length) {
      resultsSection.innerHTML = "<div>No results found.</div>";
      return;
    }

    displayCourses(items);
  } catch (err) {
    console.error(err);
    resultsSection.innerHTML = `<div style="color:red;">Failed to load filtered results</div>`;
  }
}

// ---------------------
// Load all courses initially
// ---------------------
async function loadAllCourses() {
  const url = "https://primeapps.adobe.com/almsearch/api/v1/eu/9759/5fc01dd5-de45-408d-9b07-b267d40ebef9/search";
  const resultsSection = document.querySelector(".results");
  resultsSection.innerHTML = "<div>Loading courses...</div>";

  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Failed to load courses");
    const data = await response.json();
    const items = data.hits || data.learningObjects || [];
    displayCourses(items);
  } catch (err) {
    console.error(err);
    resultsSection.innerHTML = `<div style="color:red;">Failed to load courses</div>`;
  }
}

// ---------------------
// Display course cards
// ---------------------
function displayCourses(items) {
  const resultsSection = document.querySelector(".results");
  let html = "";

  items.forEach(item => {
    const meta = item.localizedMetadata?.[0] || {};
    const title = meta.name || "Untitled";
    const desc = meta.description || "";
    const img = item.thumbnailUrl || "https://via.placeholder.com/150";

    html += `
      <div class="card">
        <img src="${img}" alt="${title}" class="card-img">
        <div class="card-content">
          <h3>${title}</h3>
          <p>${desc}</p>
        </div>
      </div>`;
  });

  resultsSection.innerHTML = html;
}
</script>
</body>
</html>
