<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ALM Learning Objects</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f5f8ff;
      margin: 0; padding: 0;
    }
    .banner {
      background: linear-gradient(317deg, rgb(164, 122, 197), rgb(31, 164, 233, 0.44));
      color: white;
      text-align: center;
      padding: 40px 20px;
    }
    .banner h1 {
      margin: 0; font-size: 2em; letter-spacing: 1px;
    }
    .banner button {
      margin-top: 15px;
      background: linear-gradient(317deg, rgb(21, 6, 125), rgb(246, 92, 203, 0.44));
      border: none; color: white; padding: 10px 20px;
      border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s;
    }
    .banner button:hover {
      background: linear-gradient(317deg, rgb(21, 6, 125), rgb(246, 92, 203, 0.44));
      opacity: 0.8;
    }
    .chatbot-modal {
      display: none; position: fixed; z-index: 9999;
      left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
    }
    .chatbot-modal.active { display: flex; }
    .chatbot-container {
      width: 600px; background: #fff; border-radius: 12px;
      box-shadow: 0 8px 24px rgba(60,60,140,.10); overflow: hidden;
      display: flex; flex-direction: column; max-height: 90vh;
    }
    .chatbot-header {
      display: flex; align-items: center; background: #f1f3fa;
      padding: 16px 24px;
      border-bottom: 1px solid #e0e0f7;
    }
    .chatbot-header h2 { flex: 1 1; margin: 0; font-size: 1.1em; }
    .chatbot-close {
      background: none; border: none; font-size: 1.2em; cursor: pointer; color: #a89eda;
    }
    .chatbot-content { display: flex; flex: 1; min-height: 300px; }
    .chatbot-messages, .chatbot-display {
      flex: 1 1 0px; padding: 0 10px;
      display: flex; flex-direction: column;
      background: #f8faff;
    }
    .chatbot-messages-header, .chatbot-display-header {
      padding: 10px 0; font-weight: 600; color: #555; font-size: 1em;
      border-bottom: 1px solid #eee;
    }
    .chatbot-messages-list {
      flex: 1 1; overflow-y: auto; max-height: 230px; padding-bottom: 5px;
    }
    .chatbot-input-area {
      display: flex; background: #fafbff;
      padding: 12px 18px; align-items: center; border-top: 1px solid #eee;
    }
    .chatbot-input-area input {
      flex: 1 1 0px; border: 1px solid #dbdbf1; border-radius: 5px; padding: 7px 10px;
      font-size: 1em; outline: none; margin-right: 12px;
    }
    .chatbot-input-area button {
      background: #8357d4; color: white; padding: 7px 18px;
      border: none; border-radius: 6px; font-size: 1em; cursor: pointer;
      transition: 0.2s;
    }
    .chatbot-input-area button:hover { background: #5b3fa8; }
    .chatbot-results { display: flex; flex-wrap: wrap; gap: 10px; padding: 16px 0;}
    .chatbot-card {
      background: #f3f0fa;
      border-radius: 8px; box-shadow: 0 2px 5px #ddd2;
      min-width: 180px; max-width: 200px;
      flex: 1 1 180px; padding: 12px 12px 12px 14px; display: flex;
      align-items: flex-start; flex-direction: row;
    }
    .chatbot-card img {
      width: 38px; height: 38px; object-fit: cover;
      border-radius: 6px; margin-right: 13px; background: #efe9ff;
    }
    .chatbot-card-content h5 {
      margin: 0 0 3px 0; font-size: 1.03em; font-weight: 600; letter-spacing: 0;
    }
    .chatbot-card-content p { margin: 0 0 6px 0; font-size: 0.93em; color: #634bcf; }
    .chatbot-message.user {
      color: #383868; background: #f7eaff;
      margin: 8px 12px 2px auto; max-width: 84%; border-radius: 10px 10px 2px 10px; padding: 7px 16px;
      text-align: right;
    }
    .chatbot-message.bot {
      color: #2b2b49; background: #eaf1ff;
      margin: 8px auto 2px 12px; max-width: 79%; border-radius: 10px 10px 10px 2px; padding: 7px 18px;
      text-align: left;
    }
    .spinner {
      border: 4px solid #eee; border-top: 4px solid #b5a1e7; border-radius: 50%; width: 22px; height: 22px; animation: spin 0.7s linear infinite; display: inline-block; margin-right: 7px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="banner">
    <h1>Explore Adobe Learning Manager Courses</h1>
    <button onclick="openChatbot()"><i class="fas fa-robot"></i> Explore Now</button>
  </div>
  <!-- ... more UI and catalog/explore panels if desired ... -->

  <!-- CHATBOT MODAL -->
  <div class="chatbot-modal" id="chatbotModal">
    <div class="chatbot-container">
      <div class="chatbot-header">
        <h2><i class="fas fa-robot"></i> Learning Search</h2>
        <button class="chatbot-close" onclick="closeChatbot()" title="Close"><i class="fas fa-times"></i></button>
      </div>
      <div class="chatbot-content">
        <div class="chatbot-messages">
          <div class="chatbot-messages-header">Conversation</div>
          <div class="chatbot-messages-list" id="chatMessages"></div>
        </div>
        <div class="chatbot-display">
          <div class="chatbot-display-header">Results</div>
          <div class="chatbot-results-container" id="chatDisplay"></div>
        </div>
      </div>
      <div class="chatbot-input-area">
        <input type="text" id="chatInput" placeholder="Ask me... e.g., Python courses, skill Photoshop, show all catalogs"/>
        <button onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i> Send</button>
      </div>
    </div>
  </div>

  <script>
    // Sample learning object data, simulate API fetch on load (substitute actual live fetch)
    let knowledgeBase = [
      {
        loId: "learningProgram:68644",
        loType: "learningProgram",
        deliveryType: "Self Paced",
        status: "Published",
        duration: 360,
        dateCreated: "2024-12-15T07:37:16.000Z",
        name: "LP3",
        averageRating: 0,
        ratingsCount: 0,
        loSkillNames: ["After Effects*", "Photoshop*"],
        loSkillLevels: ["1", "2"],
        thumbnailImageUrl: "https://cpcontents.adobe.com/eu/public/account/9759/thumbnails/learningplans/68644/2025-11-01%2014:10:11.8781916801.11.2025_15.45.21_REC_aa17a2c4c3db4a3cbab3cb659c6a290a.png",
        loInstances: [
          { id: "75771", name: "Default Instance", status: "Active", price: 0 }
        ],
        catalogInfo: [
          { id: "27076", name: "Default Catalog" }
        ]
      },
      {
        loId: "course:2098198",
        loType: "course",
        authors: ["HMM"],
        deliveryType: "Activity",
        status: "Published",
        duration: 10800,
        publishDate: "2024-01-26T15:26:51.000Z",
        dateCreated: "2024-01-26T15:26:51.000Z",
        name: "Hiring",
        description: "Hiring\nLearn how to develop a job description...",
        averageRating: 0,
        ratingsCount: 0,
        loSkillNames: ["General"],
        loSkillLevels: ["1"],
        thumbnailImageUrl: "https://hbr.org/resources/images/products/186IC_500.png",
        loInstances: [
          { id: "2180306", name: "Default instance", status: "Active", price: 0 }
        ],
        catalogInfo: [
          { id: "27076", name: "Default Catalog" },
          { id: "31002", name: "Harvard ManageMentor" }
        ]
      },
      {
        loId: "certification:48063",
        loType: "certification",
        tags: ["CE", "Certification"],
        deliveryType: "Activity",
        status: "Published",
        duration: 43200,
        publishDate: "2025-11-02T14:26:07.000Z",
        dateCreated: "2025-11-02T14:25:34.000Z",
        name: "Recurring Certification",
        description: "Continuing Education empowers professionals to stay ahead...",
        averageRating: 0,
        ratingsCount: 0,
        loSkillNames: ["General"],
        loSkillLevels: ["1"],
        thumbnailImageUrl: "https://cpcontents.adobe.com/eu/public/account/9759/thumbnails/certifications/48063/2025-11-02%2014:26:57.776516072attended_ALM_Marking_Attendance_bebd18d1ee2c4fe483faaa3a122bdb79.png",
        loInstances: [
          { id: "48297", name: "DEFAULT_INSTANCE_STR", status: "Active", completionDeadline: "30d", price: 0 }
        ],
        catalogInfo: [
          { id: "27076", name: "Default Catalog" }
        ]
      }
    ];

    // -- Helper: Modal open/close and scroll reset --
    function openChatbot() {
      document.getElementById("chatbotModal").classList.add("active");
      document.getElementById("chatMessages").innerHTML = '';
      document.getElementById("chatDisplay").innerHTML = '<p style="color:#999;text-align:center;padding:24px 0">Try asking: “Show all certifications”, “catalog Harvard”, “skill Photoshop”.</p>';
      addBotMessage("Welcome! How can I assist you with your learning catalog today?");
      setTimeout(() => { document.getElementById('chatInput').focus(); }, 200);
    }
    function closeChatbot() {
      document.getElementById("chatbotModal").classList.remove("active");
    }

    // Chat message utilities
    function addBotMessage(msg) {
      const el = document.createElement('div'); el.className = "chatbot-message bot"; el.innerText = msg;
      document.getElementById("chatMessages").appendChild(el); document.getElementById("chatMessages").scrollTop = 99999;
    }
    function addUserMessage(msg) {
      const el = document.createElement('div'); el.className = "chatbot-message user"; el.innerText = msg;
      document.getElementById("chatMessages").appendChild(el); document.getElementById("chatMessages").scrollTop = 99999;
    }

    // -- Main upgraded bot query logic --
    function sendChatMessage() {
      const input = document.getElementById("chatInput");
      const query = input.value.trim();
      if (!query) return;
      addUserMessage(query);
      input.value = "";

      // Spinner UI
      const display = document.getElementById("chatDisplay");
      display.innerHTML = '<div style="text-align:center;padding:20px"><div class="spinner"></div> AI analyzing query...</div>';

      // Lowercased, normalized string
      const lowerQuery = query.toLowerCase().trim();

      // 1. Match for loType entries
      const loTypePatterns = [
        { words: ["course","courses"], type: "course" },
        { words: ["learning path","learning paths","path","paths"], type: "learningPath" },
        { words: ["learning program","learning programs","program","programs"], type: "learningProgram" },
        { words: ["certification","certifications"], type: "certification" },
        { words: ["job aid","job aids"], type: "jobAid" }
      ];
      const catalogWords = ["catalog", "catalogs"];
      const skillPatterns = ["skill", "skills"];
      const skillLevelPatterns = ["skill level", "skills level"];

      let results = [];
      let found = false;

      // --loType filtering
      for (const {words, type} of loTypePatterns) {
        for (const w of words) {
          if (lowerQuery.includes(w)) {
            results = knowledgeBase.filter(lo => lo.loType && lo.loType.toLowerCase() === type);
            found = true; break;
          }
        }
        if (found) break;
      }
      // Explicit show all catalogs
      if (!found) for (const w of catalogWords) {
        if (lowerQuery === `show all ${w}` || lowerQuery === `list all ${w}`) {
          let catSet = new Set();
          knowledgeBase.forEach(lo =>
            Array.isArray(lo.catalogInfo) && lo.catalogInfo.forEach(cat =>
              cat.name && catSet.add(cat.name)
            )
          );
          displayCatalogCards([...catSet]);
          addBotMessage(`Found ${catSet.size} catalogs`);
          return;
        }
      }
      // Catalog search
      if (!found) for (const w of catalogWords) {
        if (lowerQuery.includes(w)) {
          const catKeyword = lowerQuery.replace(w, '').trim();
          results = knowledgeBase.filter(lo =>
            Array.isArray(lo.catalogInfo) &&
            lo.catalogInfo.some(cat =>
              cat.name && cat.name.toLowerCase().includes(catKeyword)
            )
          );
          found = true; break;
        }
      }
      // Skill/skills
      if (!found && skillPatterns.some(p => lowerQuery.includes(p))) {
        const skillKeyword = lowerQuery.replace(/skills?/, "").trim();
        results = knowledgeBase.filter(lo =>
          Array.isArray(lo.loSkillNames) &&
          lo.loSkillNames.some(skill =>
            skill.toLowerCase().includes(skillKeyword)
          )
        ); found = true;
      }
      // Skill level: "Skill level 1", etc.
      if (!found && skillLevelPatterns.some(p => lowerQuery.includes(p))) {
        const levelMatch = lowerQuery.match(/skill(s)? level\s*(\d+)/);
        if (levelMatch) {
          const lv = levelMatch[2];
          results = knowledgeBase.filter(lo =>
            Array.isArray(lo.loSkillLevels) &&
            lo.loSkillLevels.includes(lv)
          );
          found = true;
        }
      }
      // Fallback: Search in name
      if (!found) {
        results = knowledgeBase.filter(lo =>
          lo.name && lo.name.toLowerCase().includes(lowerQuery)
        );
      }
      displayChatResults(results);
      if (results.length > 0) {
        addBotMessage(`Found ${results.length} results.`);
      } else {
        addBotMessage(`No results found. Try a different keyword or check spelling!`);
      }
    }

    // Display catalog cards
    function displayCatalogCards(catalogNames) {
      const display = document.getElementById("chatDisplay");
      if (catalogNames.length === 0) {
        display.innerHTML = `<p style="color:#666;text-align:center;padding:20px">No catalogs found.</p>`;
        return;
      }
      let html = `<div class="chatbot-results">`;
      catalogNames.forEach(name => {
        html += `<div class="chatbot-card">
          <div class="chatbot-card-content">
            <h5>${name}</h5>
            <p>Catalog</p>
          </div>
        </div>`;
      });
      html += `</div>`;
      display.innerHTML = html;
    }

    // -- Show search results as cards --
    function displayChatResults(results) {
      const display = document.getElementById("chatDisplay");
      if (!results || results.length === 0) {
        display.innerHTML = `<p style="color:#888;padding:20px;text-align:center">No matches found.</p>`;
        return;
      }
      let html = `<div class="chatbot-results">`;
      results.forEach(obj => {
        html += `<div class="chatbot-card">
          ${obj.thumbnailImageUrl ? `<img src="${obj.thumbnailImageUrl}" alt="thumb"/>` : ''}
          <div class="chatbot-card-content">
            <h5>${obj.name || ''}</h5>
            <p>${obj.loType || obj.type || ''}</p>
            ${obj.deliveryType ? `<small>${obj.deliveryType}</small>` : ''}
          </div>
        </div>`;
      });
      html += `</div>`;
      display.innerHTML = html;
    }

    // Enter to send in chat input
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') sendChatMessage();
    });

  </script>
</body>
</html>
