
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALM Learning Objects</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
* { box-sizing: border-box; }
body {
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
background: #f5f8ff;
margin: 0;
padding: 0;
}
.banner {
background: linear-gradient(317deg, rgb(164 122 197), rgb(31 164 233 / 44%));
color: white;
text-align: center;
padding: 40px 20px;
}
.banner h1 {
margin: 0;
font-size: 2em;
letter-spacing: 1px;
}
.banner button {
margin-top: 15px;
background: linear-gradient(317deg, rgb(21 6 125), rgb(246 92 203 / 44%));
border: none;
color: white;
padding: 10px 20px;
border-radius: 8px;
font-size: 16px;
cursor: pointer;
transition: 0.3s;
}
.banner button:hover {
background: linear-gradient(317deg, rgb(21 6 125), rgb(246 92 203 / 44%));
}
.main-content {
display: grid;
grid-template-columns: 300px 1fr;
gap: 20px;
padding: 30px;
}
@media (max-width: 900px) {
.main-content {
grid-template-columns: 1fr;
padding: 10px;
}
.filters {
position: fixed;
left: 0;
top: 0;
width: 80vw;
max-width: 350px;
height: 100vh;
overflow-y: auto;
z-index: 1000;
background: linear-gradient(317deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
box-shadow: 2px 0 15px rgba(0,0,0,0.13);
transform: translateX(-100%);
transition: transform 0.3s;
}
.filters.open {
transform: translateX(0);
}
.filter-drawer-overlay {
display: none;
position: fixed;
inset: 0;
background: rgba(0,0,0,0.3);
z-index: 999;
}
.filter-drawer-overlay.active {
display: block;
}
}
.filters {
background: linear-gradient(317deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
border: 1px solid #ddd;
border-radius: 10px;
box-shadow: 0 4px 10px rgba(0,0,0,0.05);
padding: 20px;
display: flex;
flex-direction: column;
gap: 24px;
height: fit-content;
position: sticky;
top: 30px;
max-height: calc(100vh - 60px);
overflow-y: auto;
}
.filters::-webkit-scrollbar { width: 8px; }
.filters::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
.filters::-webkit-scrollbar-thumb { background: linear-gradient(317deg, #3b82f6, #8b5cf6); border-radius: 10px; }
.active-filters-chips { display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 14px; align-items: center; }
.filter-chip { background: #e6f0ff; color: #007bff; border-radius: 18px; padding: 5px 14px; font-size: 13px; display: inline-flex; align-items: center; }
.filter-chip .remove-chip { background: none; border: none; color: #007bff; font-size: 15px; cursor: pointer; margin-left: 6px; }
.filter-section { padding: 0 0 12px 0; border-bottom: 1px solid #e8e8e8; }
.filter-section:last-child { border-bottom: none; }
.filter-heading { margin: 0; padding: 0; color: #001f3f; font-weight: 600; font-size: 1em; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; user-select: none; }
.filter-toggle { font-size: 1.1em; margin-left: 5px; color: #666; }
.filter-content { display: none; margin-top: 10px; }
.filter-section.expanded .filter-content { display: block; }
.custom-multiselect { position: relative; margin-bottom: 10px; }
.custom-multiselect .input-search { width: 97%; padding: 6px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 3px; font-size: 14px; }
.custom-multiselect .multi-select-box { border: 1px solid #ccc; border-radius: 6px; background: #f9f9f9; max-height: 140px; overflow-y: auto; position: absolute; left: 0; right: 0; z-index: 2; display: none; }
.custom-multiselect.open .multi-select-box { display: block; }
.custom-multiselect .multi-trigger { display: flex; align-items: center; justify-content: space-between; background: #f4faff; border: 1px solid #ccc; border-radius: 6px; padding: 8px 10px; font-size: 14px; cursor: pointer; }
.custom-multiselect .multi-trigger .badge-count { background: #6088b2; color: #fff; border-radius: 8px; font-size: 11px; padding: 2px 10px; margin-left: 6px; font-weight: 500; }
.multi-select-options label { display: flex; align-items: center; font-size: 14px; padding: 4px 8px; cursor: pointer; }
.multi-select-options input[type="checkbox"] { margin-right: 7px; accent-color: #007bff; }
.select-all-row { padding: 4px 8px; background: #eef6fb; font-size: 13px; cursor: pointer; border-bottom: 1px solid #e6e6e6; }
.action-buttons-row { display: flex; gap: 12px; margin-top: 14px; }
#applyFilters { background: linear-gradient(to right, #007bff, #00c6ff); color: white; border: none; border-radius: 8px; font-size: 15px; padding: 10px 24px; cursor: pointer; transition: 0.3s; }
#applyFilters:hover { background: linear-gradient(to right, #005ecb, #00a3d4); }
#clearFilters { background: #eee; color: #001f3f; border-radius: 8px; font-size: 15px; padding: 10px 18px; border: none; cursor: pointer; }
#results { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
.card { position: relative; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 14px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center; text-decoration: none; color: #000; padding: 15px; transition: transform 0.2s; }
.card::before, .card::after { content: ""; position: absolute; left: 0; width: 100%; height: 4px; background: linear-gradient(to right, #007bff, #a400ff); }
.card::before { top: 0; }
.card::after { bottom: 0; }
.card:hover { transform: translateY(-5px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.card img { width: 100%; height: 260px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
.card h4 { background: linear-gradient(135deg, #4287f5, #8c4bc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 8px 0; font-size: 1.1em; }
#pagination { text-align: center; margin-top: 20px; }
.no-results { text-align: center; color: #005ecb; font-size: 18px; background: #eef6ff; border-radius: 10px; padding: 20px; }
@media (max-width: 900px) { #results { grid-template-columns: 1fr;} }

/* CHATBOT MODAL */
.chatbot-modal {
display: none;
position: fixed;
inset: 0;
background: rgba(0,0,0,0.6);
backdrop-filter: blur(4px);
z-index: 10000;
padding: 20px;
}
.chatbot-modal.open {
display: flex;
align-items: center;
justify-content: center;
}
.chatbot-container {
background: white;
border-radius: 20px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
width: 100%;
max-width: 70vw;
height: 85vh;
display: flex;
flex-direction: column;
overflow: hidden;
animation: slideUp 0.3s ease;
}
@keyframes slideUp {
from { transform: translateY(30px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}
.chatbot-header {
background: linear-gradient(135deg, #4287f5 0%, #8c4bc4 100%);
color: white;
padding: 20px 24px;
display: flex;
justify-content: space-between;
align-items: center;
border-bottom: 1px solid rgba(255,255,255,0.1);
}
.chatbot-header h2 {
margin: 0;
font-size: 1.5rem;
font-weight: 700;
display: flex;
align-items: center;
gap: 10px;
}
.chatbot-header-actions {
display: flex;
gap: 12px;
align-items: center;
}
.chatbot-icon-btn {
background: rgba(255,255,255,0.2);
border: none;
color: white;
width: 36px;
height: 36px;
border-radius: 8px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s;
}
.chatbot-icon-btn:hover {
background: rgba(255,255,255,0.3);
transform: scale(1.05);
}
.chatbot-content {
display: flex;
flex: 1;
gap: 12px;
padding: 12px;
overflow: hidden;
}
.chatbot-sidebar {
flex: 0 0 220px;
background: #f8f9fa;
border-radius: 12px;
overflow-y: auto;
padding: 12px;
border: 1px solid #e0e0e0;
}
.sidebar-section {
margin-bottom: 16px;
}
.sidebar-title {
font-size: 12px;
font-weight: 700;
color: #666;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 8px;
padding-left: 8px;
}
.quick-filter {
background: white;
padding: 8px 12px;
border-radius: 8px;
border: 1px solid #e0e0e0;
font-size: 13px;
color: #333;
cursor: pointer;
margin-bottom: 6px;
transition: all 0.2s;
}
.quick-filter:hover {
background: #e8eef7;
border-color: #4287f5;
color: #4287f5;
}
.quick-filter.active {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
border-color: #4287f5;
}
.chatbot-main {
flex: 1;
display: flex;
flex-direction: column;
overflow: hidden;
}
.chatbot-messages {
flex: 1;
overflow-y: auto;
padding: 16px;
background: white;
border-radius: 12px;
border: 1px solid #e0e0e0;
}
.message {
margin-bottom: 12px;
display: flex;
gap: 8px;
animation: fadeInMsg 0.3s ease;
}
@keyframes fadeInMsg {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
.message.bot {
justify-content: flex-start;
}
.message.user {
justify-content: flex-end;
}
.message-content {
max-width: 75%;
padding: 10px 14px;
border-radius: 12px;
font-size: 14px;
line-height: 1.5;
word-wrap: break-word;
}
.message.bot .message-content {
background: #e8eef7;
color: #001f3f;
border-bottom-left-radius: 4px;
}
.message.user .message-content {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
border-bottom-right-radius: 4px;
}
.chatbot-results-panel {
flex: 1;
overflow-y: auto;
padding: 12px;
background: white;
border-radius: 12px;
border: 1px solid #e0e0e0;
display: none;
}
.chatbot-results-panel.active {
display: block;
}
.results-header {
font-weight: 700;
color: #001f3f;
margin-bottom: 12px;
display: flex;
justify-content: space-between;
align-items: center;
font-size: 14px;
}
.results-sort {
display: flex;
gap: 6px;
}
.sort-btn {
background: #f0f0f0;
border: 1px solid #ddd;
padding: 4px 8px;
border-radius: 6px;
font-size: 12px;
cursor: pointer;
transition: all 0.2s;
}
.sort-btn:hover, .sort-btn.active {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
border-color: #4287f5;
}
.chatbot-results-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
gap: 12px;
}
.chatbot-card {
background: white;
border-radius: 12px;
border: 1px solid #e0e0e0;
overflow: hidden;
cursor: pointer;
transition: all 0.2s;
box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.chatbot-card:hover {
transform: translateY(-4px);
box-shadow: 0 8px 16px rgba(0,0,0,0.12);
border-color: #4287f5;
}
.chatbot-card-img {
width: 100%;
height: 90px;
object-fit: cover;
background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
}
.chatbot-card-content {
padding: 10px;
}
.chatbot-card h5 {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
margin: 0 0 4px 0;
font-size: 0.9rem;
font-weight: 600;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
.chatbot-card p {
font-size: 12px;
color: #666;
margin: 2px 0;
}
.chatbot-card-badge {
display: inline-block;
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
font-size: 10px;
padding: 3px 6px;
border-radius: 4px;
margin-top: 4px;
}
.chatbot-input-area {
border-top: 1px solid #e0e0e0;
padding: 14px;
display: flex;
gap: 10px;
background: #f9f9f9;
}
.chat-input-wrapper {
flex: 1;
display: flex;
gap: 8px;
}
.chat-input-wrapper input {
flex: 1;
padding: 12px 14px;
border: 1px solid #ddd;
border-radius: 10px;
font-size: 14px;
transition: all 0.2s;
}
.chat-input-wrapper input:focus {
outline: none;
border-color: #4287f5;
box-shadow: 0 0 0 3px rgba(66, 135, 245, 0.1);
}
.send-btn {
padding: 12px 20px;
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
border: none;
border-radius: 10px;
cursor: pointer;
font-weight: 600;
transition: all 0.2s;
display: flex;
align-items: center;
gap: 6px;
}
.send-btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(66, 135, 245, 0.3);
}
.spinner {
display: inline-block;
width: 14px;
height: 14px;
border: 2px solid #ddd;
border-top-color: #4287f5;
border-radius: 50%;
animation: spin 0.6s linear infinite;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.suggestion-chips {
display: flex;
flex-wrap: wrap;
gap: 6px;
margin-top: 8px;
}
.suggestion-chip {
background: #f0f0f0;
border: 1px solid #ddd;
padding: 6px 12px;
border-radius: 20px;
font-size: 12px;
color: #333;
cursor: pointer;
transition: all 0.2s;
}
.suggestion-chip:hover {
background: #e8eef7;
border-color: #4287f5;
color: #4287f5;
}
.info-badge {
background: #e3f2fd;
color: #1976d2;
padding: 8px 12px;
border-radius: 8px;
font-size: 11px;
margin-bottom: 8px;
border-left: 3px solid #1976d2;
}
@media (max-width: 1200px) {
.chatbot-container {
max-width: 90vw;
height: 90vh;
}
}
@media (max-width: 900px) {
.chatbot-container {
max-width: 95vw;
height: 95vh;
}
.chatbot-content {
flex-direction: column;
}
.chatbot-sidebar {
flex: 0 0 auto;
max-height: 150px;
}
}
</style>
</head>
<body>
<div class="banner">
<h1>Explore Adobe Learning Manager Courses</h1>
<button onclick="openChatbot()">Explore Now</button>
</div>
<div class="main-content">
<div class="filters" id="filtersPanel">
<div class="active-filters-chips" id="activeFiltersChips"></div>
<div class="filter-section expanded" data-section="type">
<div class="filter-heading" onclick="toggleSection(this.parentNode)">Training Type <span class="filter-toggle">‚ò∞</span></div>
<div class="filter-content">
<div class="custom-multiselect" id="multiSelect-loType">
<div class="multi-trigger" onclick="openMultiSelect('loType')"><span>Training Type</span> <span class="badge-count" id="badgeCount-loType">0</span></div>
<div class="multi-select-box" id="selectBox-loType"></div>
</div>
</div>
</div>
<div class="filter-section expanded" data-section="delivery">
<div class="filter-heading" onclick="toggleSection(this.parentNode)">Training Delivery <span class="filter-toggle">‚ò∞</span></div>
<div class="filter-content">
<div class="custom-multiselect" id="multiSelect-deliveryType">
<div class="multi-trigger" onclick="openMultiSelect('deliveryType')"><span>Delivery Types</span> <span class="badge-count" id="badgeCount-deliveryType">0</span></div>
<div class="multi-select-box" id="selectBox-deliveryType"></div>
</div>
</div>
</div>
<div class="action-buttons-row">
<button id="applyFilters"><span>Apply Filters</span> <span class="result-count" id="resultCount">(0)</span></button>
<button id="clearFilters">Clear</button>
</div>
</div>
<div>
<div id="results"></div>
<div id="pagination"></div>
</div>
</div>

<!-- CHATBOT MODAL -->
<div class="chatbot-modal" id="chatbotModal">
<div class="chatbot-container">
<div class="chatbot-header">
<h2><i class="fas fa-robot"></i> Learning Assistant</h2>
<div class="chatbot-header-actions">
<button class="chatbot-icon-btn" title="Clear chat" onclick="clearChatHistory()"><i class="fas fa-trash"></i></button>
<button class="chatbot-icon-btn" onclick="closeChatbot()"><i class="fas fa-times"></i></button>
</div>
</div>
<div class="chatbot-content">
<div class="chatbot-sidebar">
<div class="sidebar-section">
<div class="sidebar-title">Quick Filters</div>
<div class="quick-filter active" onclick="applyQuickFilter('all')">All Types</div>
<div class="quick-filter" onclick="applyQuickFilter('course')">Courses</div>
<div class="quick-filter" onclick="applyQuickFilter('certification')">Certifications</div>
<div class="quick-filter" onclick="applyQuickFilter('learningProgram')">Programs</div>
<div class="quick-filter" onclick="applyQuickFilter('jobAid')">Job Aids</div>
</div>
<div class="sidebar-section">
<div class="sidebar-title">Delivery</div>
<div class="quick-filter" onclick="applyQuickFilter('selfPaced')">Self-Paced</div>
<div class="quick-filter" onclick="applyQuickFilter('virtual')">Virtual</div>
<div class="quick-filter" onclick="applyQuickFilter('blended')">Blended</div>
</div>
<div class="sidebar-section">
<div class="sidebar-title">Recent</div>
<div id="recentQueries"></div>
</div>
</div>
<div class="chatbot-main">
<div class="chatbot-messages" id="chatMessages"></div>
<div class="chatbot-results-panel" id="chatResults"></div>
</div>
</div>
<div class="chatbot-input-area">
<div class="chat-input-wrapper">
<input type="text" id="chatInput" placeholder="Ask anything... e.g., 'Show me courses' or 'Find certifications'" />
</div>
<button class="send-btn" onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
</div>
</div>
</div>

<script>
const accountId = "9759";
const apiKey = "5fc01dd5-de45-408d-9b07-b267d40ebef9";

const filterOptions = {
loType: [
{ value: "course", text: "Course" },
{ value: "learningProgram", text: "Learning Program" },
{ value: "jobAid", text: "Job Aid" },
{ value: "certification", text: "Certification" }
],
deliveryType: [
{ value: "selfPaced", text: "Self Paced" },
{ value: "instructorLed", text: "Activity" },
{ value: "instructorLed_virtual", text: "Virtual Classroom" },
{ value: "instructorLed_blended", text: "Blended" }
]
};

const filtersState = { loType: [], deliveryType: [] };
let currentPage = 0;
const pageSize = 30;
let allResults = [];
let chatHistory = [];
let currentSortBy = 'name';
let activeQuickFilter = 'all';
let knowledgeBase = {};

// ===== KNOWLEDGE BASE FUNCTIONS =====
async function enrichCourseData(lo) {
try {
const [type, id] = lo.loId.split(':');
const detailUrl = `https://cpcontents.adobe.com/eu/public/guest/eu/api/${apiKey}/${accountId}/${type}/${id}.json`;
const res = await fetch(detailUrl);
const detail = await res.json();
const attr = detail?.data?.attributes || {};
const meta = attr.localizedMetadata?.[0] || {};

lo.imageUrl = attr.imageUrl || "https://via.placeholder.com/150x100?text=No+Image";
lo.description = meta.overview || attr.description || "";
lo.skills = lo.loSkillNames || [];
lo.difficulty = attr.difficulty || "Intermediate";
lo.author = meta.author || "";

// Store in knowledge base
knowledgeBase[lo.loId] = lo;
} catch (err) {
console.warn("Failed to enrich:", lo.loId);
lo.imageUrl = "https://via.placeholder.com/150x100?text=No+Image";
lo.description = "";
lo.skills = [];
}
return lo;
}

async function enrichAllResults(results) {
const enriched = [];
for (let lo of results) {
enriched.push(await enrichCourseData(lo));
}
return enriched;
}

function filterByKeywords(results, keywords) {
if (keywords.length === 0) return results;

return results.filter(lo => {
const searchText = [
lo.name,
lo.description,
...(lo.skills || []),
lo.difficulty
].join(" ").toLowerCase();

return keywords.some(kw => searchText.includes(kw.toLowerCase()));
});
}

// ===== CHATBOT FUNCTIONS =====
function openChatbot() {
document.getElementById('chatbotModal').classList.add('open');
if (chatHistory.length === 0) {
initializeChatbot();
}
}

function closeChatbot() {
document.getElementById('chatbotModal').classList.remove('open');
}

function clearChatHistory() {
if (confirm('Clear all chat history?')) {
chatHistory = [];
document.getElementById('chatMessages').innerHTML = '';
document.getElementById('chatResults').innerHTML = '';
document.getElementById('recentQueries').innerHTML = '';
initializeChatbot();
}
}

function initializeChatbot() {
addBotMessage("üëã Welcome! I'm your AI Learning Assistant, powered by detailed course data.");
addBotMessage("Try asking: 'Show me Python courses', 'Find certifications', or 'Self-paced trainings'");
const suggestions = ['Show all courses', 'Find certifications', 'Self-paced trainings', 'Virtual sessions'];
let html = '<div class="suggestion-chips">';
suggestions.forEach(s => {
html += `<div class="suggestion-chip" onclick="populateAndSend('${s}')">${s}</div>`;
});
html += '</div>';
const msgDiv = document.createElement('div');
msgDiv.innerHTML = html;
document.getElementById('chatMessages').appendChild(msgDiv);
}

function addBotMessage(text) {
const msgDiv = document.createElement('div');
msgDiv.className = 'message bot';
msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
document.getElementById('chatMessages').appendChild(msgDiv);
chatHistory.push({ type: 'bot', text });
document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

function addUserMessage(text) {
const msgDiv = document.createElement('div');
msgDiv.className = 'message user';
msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
document.getElementById('chatMessages').appendChild(msgDiv);
chatHistory.push({ type: 'user', text });
document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

function populateAndSend(text) {
document.getElementById('chatInput').value = text;
sendChatMessage();
}

function applyQuickFilter(filter) {
document.querySelectorAll('.quick-filter').forEach(f => f.classList.remove('active'));
event.target.classList.add('active');
activeQuickFilter = filter;

let intent = { loType: [], deliveryType: [] };
if (filter === 'course') {
intent.loType = ['course'];
populateAndSend('Show me courses');
} else if (filter === 'certification') {
intent.loType = ['certification'];
populateAndSend('Show me certifications');
} else if (filter === 'learningProgram') {
intent.loType = ['learningProgram'];
populateAndSend('Show me learning programs');
} else if (filter === 'jobAid') {
intent.loType = ['jobAid'];
populateAndSend('Show me job aids');
} else if (filter === 'selfPaced') {
intent.deliveryType = ['selfPaced'];
populateAndSend('Show me self-paced trainings');
} else if (filter === 'virtual') {
intent.deliveryType = ['instructorLed_virtual'];
populateAndSend('Show me virtual classroom sessions');
} else if (filter === 'blended') {
intent.deliveryType = ['instructorLed_blended'];
populateAndSend('Show me blended trainings');
}
}

function parseUserIntent(query) {
const lowerQuery = query.toLowerCase();
const intent = { loType: [], deliveryType: [], keywords: [] };

// Extract keywords
intent.keywords = query.split(/[\s,;]+/).filter(w => w.length > 2);

if (lowerQuery.includes('course') && !lowerQuery.includes('certification')) intent.loType.push('course');
if (lowerQuery.includes('certification')) intent.loType.push('certification');
if (lowerQuery.includes('learning program')) intent.loType.push('learningProgram');
if (lowerQuery.includes('job aid')) intent.loType.push('jobAid');
if (lowerQuery.includes('self-paced') || lowerQuery.includes('self paced')) intent.deliveryType.push('selfPaced');
if (lowerQuery.includes('virtual') || lowerQuery.includes('online')) intent.deliveryType.push('instructorLed_virtual');
if (lowerQuery.includes('blended')) intent.deliveryType.push('instructorLed_blended');
if (lowerQuery.includes('activity')) intent.deliveryType.push('instructorLed');

return intent;
}

function displayChatResults(results) {
const display = document.getElementById('chatResults');
display.classList.add('active');

if (!results || results.length === 0) {
display.innerHTML = '<p style="color:#999;text-align:center;padding:20px;">No courses found. Try different keywords!</p>';
addBotMessage("‚ùå No results found. Try different search terms.");
return;
}

allResults = results;
let html = `<div class="results-header">
<span>Found ${results.length} courses</span>
<div class="results-sort">
<button class="sort-btn ${currentSortBy==='name'?'active':''}" onclick="sortResults('name')">Name</button>
<button class="sort-btn ${currentSortBy==='duration'?'active':''}" onclick="sortResults('duration')">Duration</button>
<button class="sort-btn ${currentSortBy==='rating'?'active':''}" onclick="sortResults('rating')">Rating</button>
</div>
</div>
<div class="info-badge">üß† AI Enhanced: Using detailed course knowledge base</div>
<div class="chatbot-results-grid">`;

results.slice(0, 15).forEach(lo => {
const img = lo.imageUrl || "https://via.placeholder.com/150x100?text=No+Image";
html += `
<div class="chatbot-card" onclick="window.open('course-details.html?courseId=${lo.loId}', '_blank')">
<img src="${img}" class="chatbot-card-img" onerror="this.src='https://via.placeholder.com/150x100?text=No+Image'">
<div class="chatbot-card-content">
<h5>${lo.name}</h5>
<p><strong>${lo.loType}</strong></p>
<p>‚è±Ô∏è ${lo.duration || 'N/A'} min</p>
<p>‚≠ê ${lo.averageRating || 'N/A'}</p>
<span class="chatbot-card-badge">${lo.difficulty || 'Medium'}</span>
</div>
</div>`;
});
html += '</div>';
display.innerHTML = html;
addBotMessage(`‚úÖ Found ${results.length} courses! Using AI knowledge base for smart matching.`);
}

function sortResults(by) {
currentSortBy = by;
document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
event.target.classList.add('active');

let sorted = [...allResults];
if (by === 'name') sorted.sort((a, b) => a.name.localeCompare(b.name));
else if (by === 'duration') sorted.sort((a, b) => (a.duration || 0) - (b.duration || 0));
else if (by === 'rating') sorted.sort((a, b) => (b.averageRating || 0) - (a.averageRating || 0));

displayChatResults(sorted);
}

async function sendChatMessage() {
const input = document.getElementById('chatInput');
const query = input.value.trim();
if (!query) return;

addUserMessage(query);
input.value = '';

const display = document.getElementById('chatResults');
display.innerHTML = '<div style="text-align:center;padding:20px;"><div class="spinner"></div> AI is analyzing your request...</div>';
display.classList.add('active');

try {
const intent = parseUserIntent(query);
let filterTerms = {};
if (intent.loType.length > 0) filterTerms.loType = intent.loType;
if (intent.deliveryType.length > 0) filterTerms.deliveryType = intent.deliveryType;

// FIXED API URL
const apiUrl = `https://primeapps.adobe.com/almsearch/api/v1/eu/${accountId}/${apiKey}/search?size=50&from=0`;
const body = { query: "", filters: { terms: filterTerms }, size: 50 };

const res = await fetch(apiUrl, {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify(body)
});

const data = await res.json();
let results = data.results || [];

// Enrich results with detailed data
results = await enrichAllResults(results);

// Filter by keywords from knowledge base
results = filterByKeywords(results, intent.keywords);

displayChatResults(results);
addRecentQuery(query);

} catch (err) {
console.error("Error:", err);
display.innerHTML = '<p style="color:#d32f2f;padding:20px;">Error fetching courses. Please try again.</p>';
addBotMessage("‚ö†Ô∏è Error occurred. Please try again.");
}
}

function addRecentQuery(query) {
const recent = document.getElementById('recentQueries');
const div = document.createElement('div');
div.className = 'quick-filter';
div.textContent = query.substring(0, 18) + (query.length > 18 ? '...' : '');
div.onclick = () => populateAndSend(query);
recent.insertBefore(div, recent.firstChild);
if (recent.children.length > 5) recent.removeChild(recent.lastChild);
}

document.getElementById('chatInput').addEventListener('keypress', (e) => {
if (e.key === 'Enter') sendChatMessage();
});

// ===== FILTER FUNCTIONS =====
function toggleSection(sectionDiv) {
sectionDiv.classList.toggle('expanded');
}

function renderMultiSelect(key) {
const selectBox = document.getElementById('selectBox-' + key);
selectBox.innerHTML = '';
const searchInp = document.createElement('input');
searchInp.className = 'input-search';
searchInp.placeholder = "Search...";
selectBox.appendChild(searchInp);
}

function openMultiSelect(key) {
document.getElementById('multiSelect-'+key)?.classList.toggle('open');
renderMultiSelect(key);
}

function updateBadgeCounts() {
Object.keys(filtersState).forEach(key => {
const badge = document.getElementById('badgeCount-'+key);
if (badge) badge.innerText = filtersState[key].length;
});
}

function updateChips() {
const chipCont = document.getElementById('activeFiltersChips');
chipCont.innerHTML = '';
}

function removeChip(key, value) {
filtersState[key] = filtersState[key].filter(v => v !== value);
updateChips();
updateBadgeCounts();
}

document.getElementById("applyFilters")?.addEventListener("click", () => {
console.log("Filters applied");
});

</script>
</body>
</html>s
