
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALM Learning Objects - AI Trained</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
background: #f5f8ff;
margin: 0;
padding: 0;
}
.banner {
background: linear-gradient(317deg, rgb(164 122 197), rgb(31 164 233 / 44%));
color: white;
text-align: center;
padding: 40px 20px;
}
.banner h1 {
margin: 0;
font-size: 2em;
letter-spacing: 1px;
}
.banner button {
margin-top: 15px;
background: linear-gradient(317deg, rgb(21 6 125), rgb(246 92 203 / 44%));
border: none;
color: white;
padding: 10px 20px;
border-radius: 8px;
font-size: 16px;
cursor: pointer;
transition: 0.3s;
}
.banner button:hover {
background: linear-gradient(317deg, rgb(21 6 125), rgb(246 92 203 / 44%));
}
.main-content {
display: grid;
grid-template-columns: 300px 1fr;
gap: 20px;
padding: 30px;
}
@media (max-width: 900px) {
.main-content {
grid-template-columns: 1fr;
padding: 10px;
}
.filters {
position: fixed;
left: 0;
top: 0;
width: 80vw;
max-width: 350px;
height: 100vh;
overflow-y: auto;
z-index: 1000;
background: linear-gradient(317deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
box-shadow: 2px 0 15px rgba(0,0,0,0.13);
transform: translateX(-100%);
transition: transform 0.3s;
}
.filters.open {
transform: translateX(0);
}
.filter-drawer-overlay {
display: none;
position: fixed;
inset: 0;
background: rgba(0,0,0,0.3);
z-index: 999;
}
.filter-drawer-overlay.active {
display: block;
}
}
.filters {
background: linear-gradient(317deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
border: 1px solid #ddd;
border-radius: 10px;
box-shadow: 0 4px 10px rgba(0,0,0,0.05);
padding: 20px;
display: flex;
flex-direction: column;
gap: 24px;
height: fit-content;
position: sticky;
top: 30px;
max-height: calc(100vh - 60px);
overflow-y: auto;
}
.filters::-webkit-scrollbar { width: 8px; }
.filters::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
.filters::-webkit-scrollbar-thumb { background: linear-gradient(317deg, #3b82f6, #8b5cf6); border-radius: 10px; }
.active-filters-chips { display: flex; flex-wrap: wrap; gap: 7px; margin-bottom: 14px; align-items: center; }
.filter-chip { background: #e6f0ff; color: #007bff; border-radius: 18px; padding: 5px 14px; font-size: 13px; display: inline-flex; align-items: center; }
.filter-section { padding: 0 0 12px 0; border-bottom: 1px solid #e8e8e8; }
.filter-section:last-child { border-bottom: none; }
.filter-heading { margin: 0; padding: 0; color: #001f3f; font-weight: 600; font-size: 1em; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
.filter-toggle { font-size: 1.1em; margin-left: 5px; color: #666; }
.filter-content { display: none; margin-top: 10px; }
.filter-section.expanded .filter-content { display: block; }
#results { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
.card { position: relative; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 14px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center; text-decoration: none; color: #000; padding: 15px; transition: transform 0.2s; }
.card::before, .card::after { content: ""; position: absolute; left: 0; width: 100%; height: 4px; background: linear-gradient(to right, #007bff, #a400ff); }
.card::before { top: 0; }
.card::after { bottom: 0; }
.card:hover { transform: translateY(-5px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.card img { width: 100%; height: 260px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
.card h4 { background: linear-gradient(135deg, #4287f5, #8c4bc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 8px 0; font-size: 1.1em; }
#pagination { text-align: center; margin-top: 20px; }
@media (max-width: 900px) { #results { grid-template-columns: 1fr;} }

/* CHATBOT */
.chatbot-modal {
display: none;
position: fixed;
inset: 0;
background: rgba(0,0,0,0.5);
z-index: 10000;
}
.chatbot-modal.open {
display: flex;
align-items: center;
justify-content: center;
}
.chatbot-container {
background: white;
border-radius: 16px;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
width: 90%;
max-width: 900px;
height: 85vh;
display: flex;
flex-direction: column;
}
.chatbot-header {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
padding: 16px 20px;
border-radius: 16px 16px 0 0;
display: flex;
justify-content: space-between;
align-items: center;
}
.chatbot-header h2 {
margin: 0;
font-size: 1.3rem;
}
.chatbot-close {
background: none;
border: none;
color: white;
font-size: 24px;
cursor: pointer;
}
.chatbot-content {
display: flex;
flex: 1;
gap: 12px;
padding: 12px;
}
.chatbot-messages {
flex: 0 0 35%;
overflow-y: auto;
padding: 12px;
background: #f9fafb;
border-radius: 10px;
border: 1px solid #e0e0e0;
}
.chatbot-display {
flex: 1;
overflow-y: auto;
padding: 12px;
background: #f9fafb;
border-radius: 10px;
border: 1px solid #e0e0e0;
}
.message {
margin-bottom: 10px;
display: flex;
gap: 8px;
font-size: 13px;
}
.message.bot {
justify-content: flex-start;
}
.message.user {
justify-content: flex-end;
}
.message-content {
max-width: 95%;
padding: 8px 12px;
border-radius: 8px;
line-height: 1.4;
}
.message.bot .message-content {
background: #e8eef7;
color: #001f3f;
}
.message.user .message-content {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
}
.chatbot-results {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
gap: 12px;
}
.chatbot-card {
background: white;
border-radius: 10px;
border-top: 2px solid #4287f5;
border-bottom: 2px solid #8c4bc4;
padding: 10px;
text-align: center;
box-shadow: 0 2px 6px rgba(0,0,0,0.05);
cursor: pointer;
transition: transform 0.2s;
}
.chatbot-card:hover {
transform: translateY(-3px);
box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.chatbot-card img {
width: 100%;
height: 90px;
object-fit: cover;
border-radius: 6px;
margin-bottom: 6px;
background: #f0f0f0;
}
.chatbot-card h5 {
background: linear-gradient(135deg, #4287f5, #8c4bc4);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin: 4px 0;
font-size: 0.85rem;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
.chatbot-card p {
font-size: 0.75rem;
color: #666;
margin: 2px 0;
}
.chatbot-input-area {
border-top: 1px solid #ddd;
padding: 12px;
display: flex;
gap: 8px;
}
.chatbot-input-area input {
flex: 1;
padding: 10px 12px;
border: 1px solid #ddd;
border-radius: 8px;
font-size: 14px;
}
.chatbot-input-area button {
padding: 10px 16px;
background: linear-gradient(135deg, #4287f5, #8c4bc4);
color: white;
border: none;
border-radius: 8px;
cursor: pointer;
font-weight: 600;
}
.spinner {
display: inline-block;
width: 12px;
height: 12px;
border: 2px solid #ddd;
border-top-color: #4287f5;
border-radius: 50%;
animation: spin 0.6s linear infinite;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.query-suggestion {
background: #e8eef7;
padding: 8px 12px;
border-radius: 6px;
font-size: 12px;
color: #0055cc;
cursor: pointer;
margin-bottom: 8px;
border-left: 3px solid #0055cc;
}
</style>
</head>
<body>
<div class="banner">
<h1>Explore Adobe Learning Manager Courses</h1>
<button onclick="openChatbot()">Explore Now</button>
</div>
<div class="main-content">
<div class="filters" id="filtersPanel">
<div class="active-filters-chips" id="activeFiltersChips"></div>
</div>
<div>
<div id="results"></div>
<div id="pagination"></div>
</div>
</div>

<!-- CHATBOT MODAL -->
<div class="chatbot-modal" id="chatbotModal">
<div class="chatbot-container">
<div class="chatbot-header">
<h2>ü§ñ AI Learning Assistant (Trained)</h2>
<button class="chatbot-close" onclick="closeChatbot()">‚úï</button>
</div>
<div class="chatbot-content">
<div class="chatbot-messages" id="chatMessages"></div>
<div class="chatbot-display" id="chatDisplay"></div>
</div>
<div class="chatbot-input-area">
<input type="text" id="chatInput" placeholder="Ask me about courses..." />
<button onclick="sendChatMessage()">Send</button>
</div>
</div>
</div>

<script>
const accountId = "9759";
const apiKey = "5fc01dd5-de45-408d-9b07-b267d40ebef9";

let knowledgeBase = {};
let aiTrainingData = {
skills: {},
topics: {},
keywords: {},
authors: {},
difficulty: {},
duration: {}
};

// ===== AI TRAINING SYSTEM =====

function buildAITrainingIndex(courseData) {
  const enriched = courseData.enriched || courseData;
  
  // Extract and index skills
  if (enriched.skills && enriched.skills.length > 0) {
    enriched.skills.forEach(skill => {
      const skillKey = skill.toLowerCase();
      if (!aiTrainingData.skills[skillKey]) {
        aiTrainingData.skills[skillKey] = [];
      }
      aiTrainingData.skills[skillKey].push(courseData.loId);
    });
  }
  
  // Extract and index difficulty levels
  if (enriched.difficulty) {
    const diffKey = enriched.difficulty.toLowerCase();
    if (!aiTrainingData.difficulty[diffKey]) {
      aiTrainingData.difficulty[diffKey] = [];
    }
    aiTrainingData.difficulty[diffKey].push(courseData.loId);
  }
  
  // Extract and index keywords from description
  if (enriched.description) {
    const words = enriched.description.toLowerCase().split(/[\s\W]+/)
      .filter(w => w.length > 3 && !['the', 'and', 'for', 'with', 'from', 'that', 'this'].includes(w));
    
    words.forEach(word => {
      if (!aiTrainingData.keywords[word]) {
        aiTrainingData.keywords[word] = [];
      }
      if (!aiTrainingData.keywords[word].includes(courseData.loId)) {
        aiTrainingData.keywords[word].push(courseData.loId);
      }
    });
  }
  
  // Extract and index from course name
  const nameWords = (enriched.name || '').toLowerCase().split(/[\s\W]+/)
    .filter(w => w.length > 3);
  
  nameWords.forEach(word => {
    if (!aiTrainingData.keywords[word]) {
      aiTrainingData.keywords[word] = [];
    }
    if (!aiTrainingData.keywords[word].includes(courseData.loId)) {
      aiTrainingData.keywords[word].push(courseData.loId);
    }
  });
  
  // Extract and index topics from tags
  if (enriched.tags && enriched.tags.length > 0) {
    enriched.tags.forEach(tag => {
      const tagKey = tag.toLowerCase();
      if (!aiTrainingData.topics[tagKey]) {
        aiTrainingData.topics[tagKey] = [];
      }
      aiTrainingData.topics[tagKey].push(courseData.loId);
    });
  }
  
  // Extract and index duration ranges
  if (enriched.duration) {
    const mins = parseInt(enriched.duration);
    let durationCategory = 'short';
    if (mins > 60) durationCategory = 'medium';
    if (mins > 180) durationCategory = 'long';
    
    if (!aiTrainingData.duration[durationCategory]) {
      aiTrainingData.duration[durationCategory] = [];
    }
    aiTrainingData.duration[durationCategory].push(courseData.loId);
  }
  
  // Extract and index authors
  if (enriched.author) {
    const authorKey = enriched.author.toLowerCase();
    if (!aiTrainingData.authors[authorKey]) {
      aiTrainingData.authors[authorKey] = [];
    }
    aiTrainingData.authors[authorKey].push(courseData.loId);
  }
}

function intelligentSearch(query) {
  const lowerQuery = query.toLowerCase();
  const matchedIds = new Set();
  let matchScores = {};
  
  console.log("AI Training Data:", aiTrainingData);
  
  // Search in skills
  Object.keys(aiTrainingData.skills).forEach(skill => {
    if (lowerQuery.includes(skill)) {
      aiTrainingData.skills[skill].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 3; // High score for skill match
      });
    }
  });
  
  // Search in topics/tags
  Object.keys(aiTrainingData.topics).forEach(topic => {
    if (lowerQuery.includes(topic)) {
      aiTrainingData.topics[topic].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 2.5;
      });
    }
  });
  
  // Search in keywords
  const queryWords = lowerQuery.split(/[\s\W]+/).filter(w => w.length > 2);
  queryWords.forEach(qword => {
    Object.keys(aiTrainingData.keywords).forEach(keyword => {
      if (keyword.includes(qword) || qword.includes(keyword)) {
        aiTrainingData.keywords[keyword].forEach(id => {
          matchScores[id] = (matchScores[id] || 0) + 1;
        });
      }
    });
  });
  
  // Search for difficulty
  if (lowerQuery.includes('beginner') || lowerQuery.includes('easy')) {
    if (aiTrainingData.difficulty['beginner']) {
      aiTrainingData.difficulty['beginner'].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 2;
      });
    }
  }
  if (lowerQuery.includes('advanced') || lowerQuery.includes('expert')) {
    if (aiTrainingData.difficulty['advanced']) {
      aiTrainingData.difficulty['advanced'].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 2;
      });
    }
  }
  
  // Search for duration
  if (lowerQuery.includes('short') || lowerQuery.includes('quick')) {
    if (aiTrainingData.duration['short']) {
      aiTrainingData.duration['short'].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 1.5;
      });
    }
  }
  if (lowerQuery.includes('long') || lowerQuery.includes('comprehensive')) {
    if (aiTrainingData.duration['long']) {
      aiTrainingData.duration['long'].forEach(id => {
        matchScores[id] = (matchScores[id] || 0) + 1.5;
      });
    }
  }
  
  // Sort by relevance score
  const results = Object.keys(matchScores)
    .sort((a, b) => matchScores[b] - matchScores[a])
    .map(id => knowledgeBase[id])
    .filter(course => course);
  
  console.log("Intelligent search results:", results.length);
  return results;
}

// ===== CHATBOT FUNCTIONS =====

function openChatbot() {
  document.getElementById('chatbotModal').classList.add('open');
  document.getElementById('chatMessages').innerHTML = '';
  document.getElementById('chatDisplay').innerHTML = '';
  addBotMessage("üëã Welcome! I'm an AI-trained assistant. I understand course content, skills, difficulty levels, and more!");
  addBotMessage("Try asking: 'Python courses', 'beginner friendly training', 'short videos', 'advanced management', etc.");
  
  showSuggestions();
}

function closeChatbot() {
  document.getElementById('chatbotModal').classList.remove('open');
}

function showSuggestions() {
  const suggestions = [
    "Python courses",
    "Beginner level",
    "Advanced training",
    "Short courses",
    "Management skills"
  ];
  let html = '';
  suggestions.forEach(s => {
    html += `<div class="query-suggestion" onclick="populateAndSend('${s}')">${s}</div>`;
  });
  const msgDiv = document.createElement('div');
  msgDiv.innerHTML = html;
  document.getElementById('chatMessages').appendChild(msgDiv);
}

function populateAndSend(text) {
  document.getElementById('chatInput').value = text;
  sendChatMessage();
}

function addBotMessage(text) {
  const msgDiv = document.createElement('div');
  msgDiv.className = 'message bot';
  msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
  document.getElementById('chatMessages').appendChild(msgDiv);
  document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

function addUserMessage(text) {
  const msgDiv = document.createElement('div');
  msgDiv.className = 'message user';
  msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
  document.getElementById('chatMessages').appendChild(msgDiv);
  document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

async function fetchDetailedCourseData(lo) {
  try {
    const [type, id] = lo.loId.split(':');
    const detailUrl = `https://cpcontents.adobe.com/eu/public/guest/eu/api/${apiKey}/${accountId}/${type}/${id}.json`;
    const res = await fetch(detailUrl);
    const detail = await res.json();
    const data = detail?.data || {};
    const attr = data?.attributes || {};
    const meta = attr?.localizedMetadata?.[0] || {};

    const enrichedData = {
      id: lo.loId,
      name: lo.name,
      type: lo.loType,
      deliveryType: lo.deliveryType,
      duration: lo.duration,
      rating: lo.averageRating,
      ratingCount: lo.ratingsCount,
      imageUrl: attr?.imageUrl || "https://via.placeholder.com/150x100?text=No+Image",
      description: meta?.overview || attr?.description || "",
      learningOutcomes: attr?.learningOutcomes || [],
      prerequisites: attr?.prerequisites || "",
      difficulty: attr?.difficulty || "Intermediate",
      author: meta?.author || "",
      skills: lo.loSkillNames || [],
      tags: attr?.tags || [],
      enrollmentCount: attr?.enrollmentCount,
      language: meta?.language || "English",
      catalogs: attr?.catalogs || [],
      audiences: attr?.audiences || []
    };

    lo.enriched = enrichedData;
    knowledgeBase[lo.loId] = lo;
    
    // Train AI on this course data
    buildAITrainingIndex(lo);
    
    return lo;

  } catch (err) {
    console.warn("Failed to fetch:", lo.loId);
    lo.enriched = { name: lo.name, type: lo.loType };
    knowledgeBase[lo.loId] = lo;
    buildAITrainingIndex(lo);
    return lo;
  }
}

async function enrichAllCourseData(results) {
  const enrichedResults = [];
  for (let lo of results) {
    enrichedResults.push(await fetchDetailedCourseData(lo));
  }
  return enrichedResults;
}

function displayChatResults(results) {
  const display = document.getElementById('chatDisplay');
  display.innerHTML = '';

  if (!results || results.length === 0) {
    display.innerHTML = '<p style="color:#666;text-align:center;padding:20px;">No matches found. Try different keywords!</p>';
    addBotMessage("‚ùå No results. The AI training system found no matching courses. Try: Python, beginner, advanced, management, etc.");
    return;
  }

  let html = `<div class="chatbot-results">`;
  results.slice(0, 12).forEach(lo => {
    const enriched = lo.enriched || lo;
    const img = enriched.imageUrl || "https://via.placeholder.com/150x100?text=No+Image";
    const name = enriched.name || "Untitled";
    html += `
    <div class="chatbot-card" onclick="window.open('course-details.html?courseId=${lo.loId}', '_blank')">
      <img src="${img}" alt="Course" onerror="this.src='https://via.placeholder.com/150x100?text=No+Image'">
      <h5>${name}</h5>
      <p><strong>${lo.loType}</strong></p>
      <p>${enriched.difficulty}</p>
      <p>‚è±Ô∏è ${enriched.duration || 'N/A'} min</p>
      <p>‚≠ê ${lo.averageRating || 'N/A'}</p>
    </div>`;
  });
  html += '</div>';
  display.innerHTML = html;

  addBotMessage(`üéØ Found ${results.length} matches using AI training system! (Skills, keywords, difficulty matched)`);
}

async function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const query = input.value.trim();
  if (!query) return;

  addUserMessage(query);
  input.value = '';

  const display = document.getElementById('chatDisplay');
  display.innerHTML = `<div style="text-align:center;padding:20px;"><div class="spinner"></div> AI analyzing query...</div>`;

  try {
    const lowerQuery = query.toLowerCase();
    let results = [];
    
    // Determine if it's a type query or content query
    const types = ['course', 'certification', 'program', 'learning program', 'job aid'];
    const isTypeQuery = types.some(t => lowerQuery.includes(t));
    
    let filterTerms = {};
    
    // Map user terms to API types
    if (lowerQuery.includes('certification')) {
      filterTerms.loType = ['certification'];
    } else if (lowerQuery.includes('program')) {
      filterTerms.loType = ['learningProgram'];
    } else if (lowerQuery.includes('job aid')) {
      filterTerms.loType = ['jobAid'];
    } else if (lowerQuery.includes('course')) {
      filterTerms.loType = ['course'];
    }

    // Fetch from API
    const apiUrl = `https://primeapps.adobe.com/almsearch/api/v1/eu/${accountId}/${apiKey}/search?size=100&from=0`;
    const body = { query: "", filters: { terms: filterTerms }, size: 100 };

    const res = await fetch(apiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    let initialResults = data.results || [];
    
    // Enrich with detailed data
    initialResults = await enrichAllCourseData(initialResults);
    
    // Use AI training to filter and rank results
    if (!isTypeQuery && query.length > 0) {
      results = intelligentSearch(query);
      if (results.length === 0) {
        // Fallback to all fetched results if AI training found nothing
        results = initialResults;
      }
    } else {
      results = initialResults;
    }

    displayChatResults(results);

  } catch (err) {
    console.error("Error:", err);
    display.innerHTML = '<p style="color:#d32f2f;padding:20px;">Error fetching courses.</p>';
    addBotMessage("‚ö†Ô∏è Error occurred. Please try again.");
  }
}

document.getElementById('chatInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendChatMessage();
});
</script>
</body>
</html>
