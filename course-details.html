<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Details | ALM</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: #f5f7fa;
      color: #333;
    }

    header {
      background: linear-gradient(90deg, #007aff, #00aaff);
      color: #fff;
      text-align: center;
      padding: 1rem 0;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .container {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .card {
      background: white;
      border: 2px solid transparent;
      border-image: linear-gradient(to right, #007aff, #00aaff) 1;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    .card h2, .card h3, .card h4 {
      margin-top: 0;
      color: #007aff;
    }

    .meta {
      font-size: 0.95rem;
      color: #666;
      margin-bottom: 0.5rem;
    }

    .expand-btn {
      background: none;
      border: none;
      color: #007aff;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.5rem;
      padding: 0;
      transition: color 0.2s;
    }

    .expand-btn:hover {
      color: #005ecc;
      text-decoration: underline;
    }

    .section {
      margin-top: 1rem;
      border-top: 1px solid #e3e3e3;
      padding-top: 1rem;
    }

    .sub-card {
      background: #f9fbff;
      border-radius: 12px;
      border: 1px solid #dce7ff;
      padding: 1rem;
      margin-top: 1rem;
    }

    .hidden {
      display: none;
    }

    .register-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      background: linear-gradient(90deg, #007aff, #00aaff);
      color: #fff;
      border: none;
      border-radius: 10px;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .register-btn:hover {
      background: linear-gradient(90deg, #005ecc, #0084cc);
      transform: translateY(-2px);
    }

    footer {
      background: linear-gradient(90deg, #007aff, #00aaff);
      color: white;
      text-align: center;
      padding: 1rem 0;
      margin-top: 3rem;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .card { padding: 1rem; }
      .sub-card { padding: 0.8rem; }
    }
  </style>
</head>
<body>
  <header>Learning Details</header>
  <div class="container">
    <div id="courseDetails">Loading details...</div>
  </div>
  <footer>Â© 2025 Adobe Learning Manager Styled Portal</footer>

  <script>
    const params = new URLSearchParams(window.location.search);
    const courseId = params.get('courseId');
    const apiBase = 'https://cpcontents.adobe.com/public/guest/production/api/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/108079/';
    const detailsDiv = document.getElementById('courseDetails');

    async function fetchDetails() {
      try {
        const response = await fetch(`${apiBase}${courseId}.json`);
        const data = await response.json();
        displayDetails(data);
      } catch (err) {
        detailsDiv.innerHTML = `<p style="color:red">Error loading details.</p>`;
      }
    }

    function displayDetails(data) {
      const main = data.data;
      const included = data.included || [];
      const meta = main.attributes.localizedMetadata?.[0] || {};

      let html = `
        <div class="card">
          <h2>${meta.name || 'Untitled'}</h2>
          <div class="meta">Type: ${main.attributes.loType} | Format: ${main.attributes.loFormat}</div>
          <p>${meta.description || 'No description available.'}</p>
          <p><strong>Duration:</strong> ${main.attributes.duration || 'N/A'} sec</p>
          <a class="register-btn" href="https://learningmanager.adobe.com/accountiplogin?ipId=18979&accesskey=bsni4medbhhps" target="_blank">Register</a>
      `;

      // subLOs (courses or modules)
      const subLOs = main.relationships?.subLOs?.data || [];
      if (subLOs.length > 0) {
        html += `<div class="section"><h3>Modules / Sub-Courses</h3>`;
        subLOs.forEach(sub => {
          const subObj = included.find(i => i.id === sub.id);
          if (subObj) html += renderSubLO(subObj, included);
        });
        html += `</div>`;
      }

      html += `</div>`;
      detailsDiv.innerHTML = html;
    }

    function renderSubLO(subObj, included) {
      const meta = subObj.attributes.localizedMetadata?.[0] || {};
      const resources = included.filter(i =>
        i.type === 'learningObjectResource' &&
        i.relationships.learningObject?.data.id === subObj.id
      );

      let html = `
        <div class="sub-card">
          <h4>${meta.name || 'Module / Course'}</h4>
          <p>${meta.description || ''}</p>
          <p><strong>Type:</strong> ${subObj.attributes.loType} | <strong>Format:</strong> ${subObj.attributes.loFormat}</p>
      `;

      if (resources.length > 0) {
        html += `<button class="expand-btn" onclick="toggleSection(this)">Hide Formats</button>
        <div class="section formats">`;
        resources.forEach(res => {
          const resRel = res.relationships.resources?.data || [];
          resRel.forEach(rr => {
            const resObj = included.find(i => i.id === rr.id);
            if (resObj) {
              html += `
                <div class="sub-card">
                  <p><strong>Format Name:</strong> ${resObj.attributes.name}</p>
                  <p><strong>Type:</strong> ${resObj.attributes.contentType}</p>
                  <a href="${resObj.attributes.location}" target="_blank" class="register-btn">Open Content</a>
                </div>
              `;
            }
          });
        });
        html += `</div>`;
      }

      html += `</div>`;
      return html;
    }

    function toggleSection(btn) {
      const section = btn.nextElementSibling;
      section.classList.toggle('hidden');
      btn.textContent = section.classList.contains('hidden') ? 'Show Formats' : 'Hide Formats';
    }

    fetchDetails();
  </script>
</body>
</html>
