<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Learning Object Details</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: "Inter", sans-serif;
      margin: 0;
      background: linear-gradient(to bottom right, #e3f2fd, #f5f9ff);
      color: #222;
      padding: 20px;
    }

    .container {
      max-width: 1100px;
      margin: auto;
    }

    .card {
      background: rgba(255, 255, 255, 0.7);
      border-top: 3px solid #4fa3ff;
      border-bottom: 3px solid #4fa3ff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      margin-bottom: 24px;
      overflow: hidden;
      backdrop-filter: blur(8px);
    }

    .card-header {
      position: relative;
      padding: 40px 20px 20px 20px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      text-align: center;
    }

    .card-header::before {
      content: "";
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      opacity: 0.25; /* Controls image visibility */
      z-index: 0;
    }

    .card-header h2, .card-header p {
      position: relative;
      z-index: 1;
      margin: 0;
    }

    .card-header h2 {
      font-size: 1.8rem;
      font-weight: 600;
    }

    .card-content {
      padding: 20px;
    }

    .section {
      margin-bottom: 18px;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #0056d6;
      margin-bottom: 6px;
    }

    .module-card, .sub-course-card {
      background: rgba(255, 255, 255, 0.8);
      border-left: 3px solid #4fa3ff;
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 12px;
      transition: transform 0.2s ease;
    }

    .module-card:hover, .sub-course-card:hover {
      transform: translateY(-3px);
    }

    .module-title {
      font-weight: 600;
      font-size: 1rem;
      color: #004b9c;
    }

    .resource-info {
      display: flex;
      align-items: center;
      margin-top: 6px;
      color: #444;
      font-size: 0.9rem;
    }

    .resource-info i {
      color: #4fa3ff;
      margin-right: 6px;
      width: 18px;
      text-align: center;
    }

    .meta-info {
      margin-top: 10px;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .error {
      text-align: center;
      color: #d32f2f;
      font-weight: 500;
    }

    a.register-btn {
      display: inline-block;
      padding: 10px 18px;
      background: linear-gradient(to right, #007bff, #0056d6);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin-top: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    a.register-btn:hover {
      background: linear-gradient(to right, #0056d6, #0040aa);
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="detailsContainer" class="card">
      <div class="card-header" id="headerSection">
        <h2>Loading...</h2>
        <p>Please wait</p>
      </div>
      <div class="card-content" id="detailsContent"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("courseId");
    const headerSection = document.getElementById("headerSection");
    const detailsContent = document.getElementById("detailsContent");

    async function fetchDetails() {
      try {
        if (!courseId) throw new Error("Missing courseId");
        const [type, id] = courseId.split(":");
        const baseUrl = "https://cpcontents.adobe.com/eu/public/guest/eu/api/5fc01dd5-de45-408d-9b07-b267d40ebef9/9759";
        const url = `${baseUrl}/${type}/${id}.json`;

        const response = await fetch(url);
        if (!response.ok) throw new Error("API request failed");

        const data = await response.json();
        displayDetails(data);
      } catch (err) {
        console.error(err);
        headerSection.innerHTML = "<h2>Error loading details</h2>";
        detailsContent.innerHTML = "<p class='error'>Unable to load details.</p>";
      }
    }

    function displayDetails(data) {
      const lo = data.data;
      if (!lo) return;

      const attr = lo.attributes || {};
      const rel = lo.relationships || {};
      const bannerUrl = attr.bannerUrl || "";

      // Background image for header
      headerSection.style.setProperty("--banner-url", `url('${bannerUrl}')`);
      headerSection.style.background = "rgba(0, 0, 0, 0.6)";
      headerSection.querySelector("h2").textContent = attr.localizedMetadata?.title || "Untitled";
      headerSection.querySelector("p").textContent = attr.localizedMetadata?.description?.substring(0, 150) || "No description available";
      headerSection.style.backgroundSize = "cover";
      headerSection.style.backgroundPosition = "center";
      headerSection.style.setProperty("background-image", `linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), url('${bannerUrl}')`);

      const type = lo.type;
      const duration = attr.duration || "N/A";
      const skills = attr.skills?.map(s => s.skillName !== "Unnamed Skill" ? s.skillName : "").filter(Boolean).join(", ") || "N/A";
      const skillLevel = attr.skillLevel || "N/A";
      const credits = attr.maxCredits || "N/A";

      let html = `
        <div class="section">
          <div class="section-title">Your Learning Journey for this ${type}</div>
          <div class="meta-info">
            <strong>Title:</strong> ${attr.localizedMetadata?.title || "Untitled"}<br>
            <strong>Description:</strong> ${attr.localizedMetadata?.description || "No description available"}<br>
            <strong>Duration:</strong> ${duration} mins<br>
            <strong>Skills:</strong> ${skills}<br>
            <strong>Skill Level:</strong> ${skillLevel}<br>
            <strong>Skill Credits:</strong> ${credits}<br>
          </div>
          <a href="https://learningmanager.adobe.com/accountiplogin?ipId=18979&accesskey=bsni4medbhhps" class="register-btn">Register</a>
        </div>
      `;

      // If type is course → show modules
      if (type === "course" && rel.learningObjectResource?.data) {
        const modules = rel.learningObjectResource.data;
        html += `<div class="section"><div class="section-title">Modules</div>`;
        modules.forEach(mod => {
          const modData = data.included.find(m => m.id === mod.id);
          if (modData) {
            const modAttr = modData.attributes;
            html += `
              <div class="module-card">
                <div class="module-title">${modAttr.localizedMetadata?.title || "Untitled Module"}</div>
                <div class="meta-info"><i class="fa-solid fa-clock"></i> ${modAttr.duration || "N/A"} mins</div>
              </div>`;
          }
        });
        html += `</div>`;
      }

      // If type is learningProgram or certification → show sub courses and their modules
      if ((type === "learningProgram" || type === "certification") && rel.subLoList?.data) {
        const subCourses = rel.subLoList.data;
        html += `<div class="section"><div class="section-title">Courses</div>`;
        subCourses.forEach(sub => {
          const subData = data.included.find(m => m.id === sub.id);
          if (subData) {
            const subAttr = subData.attributes || {};
            const subRel = subData.relationships || {};
            html += `
              <div class="sub-course-card">
                <div class="module-title">${subAttr.localizedMetadata?.title || "Untitled Course"}</div>
                <div class="meta-info"><i class="fa-solid fa-clock"></i> ${subAttr.duration || "N/A"} mins</div>
            `;
            if (subRel.learningObjectResource?.data) {
              html += `<div class="section"><div class="section-title">Modules</div>`;
              subRel.learningObjectResource.data.forEach(mod => {
                const modData = data.included.find(m => m.id === mod.id);
                if (modData) {
                  const modAttr = modData.attributes;
                  html += `
                    <div class="module-card">
                      <div class="module-title">${modAttr.localizedMetadata?.title || "Untitled Module"}</div>
                      <div class="meta-info"><i class="fa-solid fa-clock"></i> ${modAttr.duration || "N/A"} mins</div>
                    </div>`;
                }
              });
              html += `</div>`;
            }
            html += `</div>`;
          }
        });
        html += `</div>`;
      }

      detailsContent.innerHTML = html;
    }

    fetchDetails();
  </script>
</body>
</html>
