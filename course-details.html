<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Course Details</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    padding: 0;
    color: #1e1e1e;
  }
  header {
    text-align: center;
    background: linear-gradient(135deg, #007aff, #4facfe);
    color: white;
    padding: 18px 0;
    font-size: 1.6em;
    font-weight: 600;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  }
  .container {
    max-width: 900px;
    margin: 30px auto;
    padding: 0 20px;
  }
  .card {
    background: white;
    border: 2px solid transparent;
    border-radius: 16px;
    background-image: linear-gradient(white, white), linear-gradient(135deg, #4facfe, #007aff);
    background-origin: border-box;
    background-clip: content-box, border-box;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 20px;
    padding: 20px;
    transition: all 0.3s ease;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }
  .collapsible {
    cursor: pointer;
    background: linear-gradient(135deg, #4facfe, #007aff);
    color: white;
    border: none;
    padding: 10px 15px;
    width: 100%;
    text-align: left;
    border-radius: 10px;
    font-size: 1em;
    margin-top: 10px;
    transition: background 0.3s ease;
  }
  .collapsible:hover {
    background: linear-gradient(135deg, #6fc3ff, #339aff);
  }
  .content {
    padding: 10px 15px;
    display: block;
    background-color: #f9fbff;
    border-radius: 10px;
    margin-top: 8px;
  }
  .chapter {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
  }
  .chapter img {
    width: 20px;
    height: 20px;
    filter: hue-rotate(190deg) saturate(1.5);
  }
  footer {
    text-align: center;
    padding: 15px 0;
    color: #555;
    background-color: #f0f3f8;
    border-top: 1px solid #dfe3e8;
    margin-top: 40px;
  }
  .register-btn {
    display: inline-block;
    background: linear-gradient(135deg, #4facfe, #007aff);
    color: white;
    text-decoration: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 500;
    margin-top: 10px;
    transition: all 0.3s ease;
  }
  .register-btn:hover {
    background: transparent;
    color: #007aff;
    border: 2px solid #007aff;
  }
</style>
</head>
<body>

<header>Course Details</header>
<div class="container" id="courseDetails">Loading details...</div>
<footer>¬© 2025 Adobe Learning Manager | Apple UI Theme</footer>

<script>
async function fetchDetails() {
  const urlParams = new URLSearchParams(window.location.search);
  const courseId = urlParams.get("courseId") || "3958497";
  const apiUrl = `https://cpcontents.adobe.com/public/guest/production/api/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/108079/course/${courseId}.json`;
  const container = document.getElementById("courseDetails");

  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error("Network response was not ok");
    const json = await res.json();

    container.innerHTML = buildDetails(json);
  } catch (err) {
    console.error(err);
    container.innerHTML = `<p style="color:red;">Error loading details.</p>`;
  }
}

function buildDetails(data) {
  // Get main object safely
  const item = data.data?.attributes || {};
  const title = item.localizedMetadata?.[0]?.name || "Untitled";
  const description = item.localizedMetadata?.[0]?.description || "No description available.";

  let html = `
    <div class="card">
      <h2>${title}</h2>
      <p>${description}</p>
      <a class="register-btn" href="https://learningmanager.adobe.com/accountiplogin?ipId=18979&accesskey=bsni4medbhhps" target="_blank">Register</a>
    </div>
  `;

  // Fetch included modules
  const included = data.included || [];
  const modules = included.filter(x => x.type === "learningObjectResource" || x.type === "learningObject");

  if (modules.length > 0) {
    html += `<div class="card"><h3>Modules</h3>`;
    modules.forEach(mod => {
      const modTitle = mod.attributes?.localizedMetadata?.[0]?.name || "Untitled Module";
      const modDesc = mod.attributes?.localizedMetadata?.[0]?.description || "";
      const modFormat = mod.attributes?.resourceType || "Unknown";

      const resources = included.filter(r => r.type === "resource" && r.relationships?.parentLoResource?.data?.id === mod.id);
      html += `
        <button class="collapsible">${modTitle}</button>
        <div class="content">
          <p>${modDesc}</p>
          <strong>Type:</strong> ${modFormat}
          <div class="module">${resources.map(createChapter).join("")}</div>
        </div>
      `;
    });
    html += `</div>`;
  }

  return html;
}

function createChapter(r) {
  const format = (r.attributes?.format || "").toLowerCase();
  const title = r.attributes?.localizedMetadata?.[0]?.name || "Untitled Chapter";

  let icon = "üìÑ";
  if (format.includes("scorm")) icon = "‚öôÔ∏è";
  else if (["pdf", "ppt", "pptx", "doc", "docx"].some(f => format.includes(f))) icon = "üìò";
  else if (["mp4", "mov", "video"].some(f => format.includes(f))) icon = "üéûÔ∏è";
  else if (format.includes("vc")) icon = "üíª";
  else if (format.includes("cr")) icon = "üè´";

  return `<div class="chapter"><span>${icon}</span><span>${title}</span></div>`;
}

fetchDetails();
</script>
</body>
</html>
