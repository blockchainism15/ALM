<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Course Details | Apple Style</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f9fbff;
      margin: 0;
      padding: 0;
      color: #222;
    }

    header {
      background: linear-gradient(to right, #007aff, #00b4ff);
      color: white;
      text-align: center;
      padding: 1.5rem 0;
      font-size: 1.8rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 1rem;
    }

    .card {
      background: white;
      border: 2px solid;
      border-image: linear-gradient(to right, #007aff, #00b4ff) 1;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: scale(1.01);
    }

    .card h2 {
      color: #007aff;
      margin-top: 0;
      font-size: 1.5rem;
    }

    .section-title {
      border-left: 5px solid #007aff;
      padding-left: 10px;
      font-size: 1.3rem;
      margin: 2rem 0 1rem;
      font-weight: 600;
    }

    .info-line {
      margin: 0.3rem 0;
      font-size: 1rem;
    }

    .badge {
      width: 70px;
      height: 70px;
      border-radius: 12px;
      object-fit: contain;
      border: 2px solid #007aff;
      margin-right: 10px;
    }

    .register-btn {
      display: inline-block;
      background: linear-gradient(to right, #007aff, #00b4ff);
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .register-btn:hover {
      background: white;
      color: #007aff;
      border: 2px solid #007aff;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: linear-gradient(to right, #007aff, #00b4ff);
      color: white;
      font-weight: 500;
      border-top: 2px solid #007aff;
    }

    @media (max-width: 768px) {
      .card {
        padding: 1rem;
      }
      .card h2 {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <header>Learning Object Details</header>
  <div class="container" id="content">
    <p>Loading details...</p>
  </div>
  <footer>Adobe Learning Manager â€“ Course Viewer</footer>

  <script>
    async function fetchDetails() {
      const content = document.getElementById("content");
      const params = new URLSearchParams(window.location.search);
      const courseId = params.get("courseId");

      if (!courseId) {
        content.innerHTML = "<p>No courseId found in URL.</p>";
        return;
      }

      try {
        const url = `https://cpcontents.adobe.com/public/guest/production/api/9b1e6b7f-20f3-4c49-a9c8-f5f4131096f8/108079/${courseId.replace(':', '/')}.json`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Error fetching data");
        const data = await res.json();

        renderDetails(data);
      } catch (err) {
        content.innerHTML = `<p style="color:red;">Error loading data</p>`;
        console.error(err);
      }
    }

    function renderDetails(data) {
      const content = document.getElementById("content");
      const lo = data.data;
      const attrs = lo.attributes;
      const name = attrs.localizedMetadata?.[0]?.name || "Untitled";
      const desc = attrs.localizedMetadata?.[0]?.description || "No description available";
      const loType = attrs.loType || "Learning Object";
      const duration = attrs.duration ? (attrs.duration / 60) + " mins" : "N/A";
      const state = attrs.state || "N/A";
      const enrollType = attrs.enrollmentType || "N/A";
      const badge = data.included?.find(i => i.type === "badge");
      const subLOs = data.included?.filter(i => i.type === "learningObject" && i.id !== lo.id) || [];
      const loResources = data.included?.filter(i => i.type === "learningObjectResource") || [];
      const resources = data.included?.filter(i => i.type === "resource") || [];

      let html = `
        <div class="card">
          <h2>${name}</h2>
          <p class="info-line"><strong>Type:</strong> ${loType}</p>
          <p class="info-line"><strong>Duration:</strong> ${duration}</p>
          <p class="info-line"><strong>State:</strong> ${state}</p>
          <p class="info-line"><strong>Enrollment:</strong> ${enrollType}</p>
          <p class="info-line"><strong>Description:</strong> ${desc}</p>
          ${badge ? `<img class="badge" src="${badge.attributes.imageUrl}" alt="Badge" />` : ""}
          <br><br>
          <a href="https://learningmanager.adobe.com/accountiplogin?ipId=18979&accesskey=bsni4medbhhps" target="_blank" class="register-btn">Register</a>
        </div>
      `;

      if (subLOs.length > 0) {
        html += `<div class="section-title">Modules</div>`;
        subLOs.forEach(mod => {
          const mName = mod.attributes.localizedMetadata?.[0]?.name || "Unnamed Module";
          const mType = mod.attributes.loType || "Module";
          const mFormat = mod.attributes.loFormat || "N/A";
          const mDuration = mod.attributes.duration ? (mod.attributes.duration / 60) + " mins" : "N/A";
          html += `
            <div class="card">
              <h3>${mName}</h3>
              <p class="info-line"><strong>Type:</strong> ${mType}</p>
              <p class="info-line"><strong>Format:</strong> ${mFormat}</p>
              <p class="info-line"><strong>Duration:</strong> ${mDuration}</p>
            </div>
          `;
        });
      }

      if (loResources.length > 0) {
        html += `<div class="section-title">Module Resources</div>`;
        loResources.forEach(r => {
          const rName = r.attributes.localizedMetadata?.[0]?.name || "Unnamed Resource";
          const rType = r.attributes.resourceType || "Unknown";
          html += `
            <div class="card">
              <h3>${rName}</h3>
              <p class="info-line"><strong>Type:</strong> ${rType}</p>
            </div>
          `;
        });
      }

      if (resources.length > 0) {
        html += `<div class="section-title">Content Formats</div>`;
        resources.forEach(res => {
          const resName = res.attributes.name || "Unnamed Content";
          const resType = res.attributes.contentType || "Unknown";
          const resLocation = res.attributes.location ? `<a href="${res.attributes.location}" target="_blank">Open Content</a>` : "N/A";
          html += `
            <div class="card">
              <h3>${resName}</h3>
              <p class="info-line"><strong>Format:</strong> ${resType}</p>
              <p class="info-line"><strong>Launch:</strong> ${resLocation}</p>
            </div>
          `;
        });
      }

      content.innerHTML = html;
    }

    fetchDetails();
  </script>
</body>
</html>
