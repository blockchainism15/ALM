<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALM Course Details</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(120deg, #f5f7fa, #c3cfe2);
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 20px;
  }
  .card {
    background: rgba(255, 255, 255, 0.7);
    border-top: 3px solid;
    border-image: linear-gradient(90deg, #4A90E2, #8E2DE2) 1;
    border-bottom: 3px solid;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 25px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }
  .card-header {
    position: relative;
    background: rgba(255,255,255,0.3);
    border-radius: 12px;
    padding: 20px;
    font-weight: 600;
    font-size: 1.5rem;
    color: #0a2540;
    overflow: hidden;
  }
  .card-header::before {
    content: "";
    background-size: cover;
    background-position: center;
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    opacity: 0.15;
    z-index: 0;
  }
  .card-header h2, .card-header p {
    position: relative;
    z-index: 1;
  }
  .card-content {
    margin-top: 15px;
    color: #1f2937;
    font-size: 1rem;
    line-height: 1.6;
  }
  .thumbnail {
    width: 140px;
    border-radius: 12px;
    margin-bottom: 15px;
    display: block;
  }
  .register-btn {
    display: inline-block;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    border: 2px solid;
    border-image: linear-gradient(90deg, #4A90E2, #8E2DE2) 1;
    background: transparent;
    color: #4A90E2;
    transition: all 0.3s ease;
  }
  .register-btn:hover {
    background: linear-gradient(90deg, #4A90E2, #8E2DE2);
    color: white;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.2rem;
    margin-top: 20px;
    color: #0a2540;
  }
  .sub-card {
    background: rgba(255,255,255,0.6);
    border-radius: 10px;
    padding: 15px;
    margin-top: 10px;
  }
  .label {
    font-weight: 600;
    color: #374151;
  }
  .format-tag {
    display: inline-block;
    margin-left: 10px;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.85rem;
    color: white;
  }
</style>
</head>
<body>
<div class="container">
  <div id="details"></div>
</div>

<script>
const apiBase = "https://cpcontents.adobe.com/eu/public/guest/eu/api/5fc01dd5-de45-408d-9b07-b267d40ebef9/9759";

async function loadDetails() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  const type = params.get('type') || 'course';
  if (!id) return;

  const url = `${apiBase}/${type}/${id}.json`;
  const container = document.getElementById("details");

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Failed to load");
    const data = await res.json();
    renderDetails(data);
  } catch (e) {
    container.innerHTML = `<p style="color:red;">Failed to load course details.</p>`;
  }
}

function getFormatTag(format) {
  let label = format;
  let color = "#10b981";
  if (["SCORM12", "SCORM2004", "CP"].includes(format)) {
    label = "Interactive";
    color = "#2563eb";
  } else if (format === "VIDEO") color = "#ef4444";
  else if (format === "PDF") color = "#9333ea";
  else if (["DOC", "DOCX", "PPT", "PPTX"].includes(format)) color = "#f59e0b";
  return `<span class="format-tag" style="background:${color}">${label}</span>`;
}

function renderDetails(data) {
  const container = document.getElementById("details");
  const attrs = data.attributes || {};
  const relationships = data.relationships || {};
  const bannerUrl = attrs.bannerUrl || "";
  const loType = attrs.loType || "learningObject";
  const included = data.included || [];

  let html = `
  <div class="card">
    <div class="card-header" style="--bg:url(${bannerUrl})">
      <img src="${attrs.imageUrl || bannerUrl}" alt="thumbnail" class="thumbnail">
      <h2>${attrs.localizedMetadata?.title || 'Untitled'}</h2>
      <p>${attrs.localizedMetadata?.description || 'No description available'}</p>
    </div>
    <div class="card-content">
      <p><strong>Your Learning Journey for this ${loType}</strong></p>
      <p><span class="label">Title:</span> ${attrs.localizedMetadata?.title || 'N/A'}</p>
      <p><span class="label">Description:</span> ${attrs.localizedMetadata?.description || 'N/A'}</p>
      <p><span class="label">Duration:</span> ${attrs.duration || 'N/A'} mins</p>
      <p><span class="label">Skills:</span> ${attrs.skills?.map(s=>s.name).join(", ") || 'N/A'}</p>
      <p><span class="label">Skill Level:</span> ${attrs.skillLevel || 'N/A'}</p>
      <p><span class="label">Skill Credits:</span> ${attrs.maxCredits || 'N/A'}</p>
      <a href="https://learningmanager.adobe.com/accountiplogin?ipId=18979&accesskey=bsni4medbhhps" target="_blank" class="register-btn">Register</a>
    </div>`;

  // Handle learning programs or certifications (with courses/subLOs)
  if (relationships.subLoList?.data?.length > 0) {
    html += `<h3 class="section-title">Courses</h3>`;
    relationships.subLoList.data.forEach(sub => {
      const subObj = included.find(i => i.id === sub.id);
      if (!subObj) return;
      const subAttr = subObj.attributes || {};
      const subRel = subObj.relationships || {};

      html += `
        <div class="sub-card">
          <p><strong>${subAttr.localizedMetadata?.title || 'Untitled Course'}</strong></p>
          <p>${subAttr.localizedMetadata?.description || 'No description available'}</p>
          <p><span class="label">Type:</span> ${subAttr.loType || 'N/A'}</p>
          <p><span class="label">Duration:</span> ${subAttr.duration || 'N/A'} mins</p>`;

      // show learningObjectResources under each sub-course
      if (subRel.learningObjectResourceList?.data?.length > 0) {
        html += `<div class="section-title">Modules</div>`;
        subRel.learningObjectResourceList.data.forEach(lor => {
          const lorObj = included.find(i => i.id === lor.id);
          if (!lorObj) return;
          const lorAttr = lorObj.attributes || {};
          html += `
            <div class="sub-card">
              <p><strong>${lorAttr.localizedMetadata?.title || 'Untitled Resource'}</strong></p>
              <p><span class="label">Duration:</span> ${lorAttr.duration || 'N/A'} mins</p>
              <p><span class="label">Format:</span> ${getFormatTag(lorAttr.resourceType || 'N/A')}</p>
            </div>`;
        });
      }
      html += `</div>`;
    });
  }

  // Handle modules for direct course
  if (relationships.learningObjectResourceList?.data?.length > 0) {
    html += `<h3 class="section-title">Modules</h3>`;
    relationships.learningObjectResourceList.data.forEach(item => {
      const modObj = included.find(i => i.id === item.id);
      if (!modObj) return;
      const modAttr = modObj.attributes || {};
      html += `
        <div class="sub-card">
          <p><strong>${modAttr.localizedMetadata?.title || 'Untitled Module'}</strong></p>
          <p><span class="label">Duration:</span> ${modAttr.duration || 'N/A'} mins</p>
          <p><span class="label">Format:</span> ${getFormatTag(modAttr.resourceType || 'N/A')}</p>
        </div>`;
    });
  }

  html += `</div>`;
  container.innerHTML = html;

  // Apply banner background image
  const headers = document.querySelectorAll(".card-header");
  headers.forEach(h => {
    const bg = h.style.getPropertyValue("--bg");
    if (bg && bg !== "url()") h.style.backgroundImage = `url(${bg})`;
  });
}

loadDetails();
</script>
</body>
</html>
