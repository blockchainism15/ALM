<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learning Object Details</title>
<style>
    body { font-family: 'SF Pro Display', Arial, sans-serif; background-color:#f5f5f7; margin:0; padding:20px; color:#1d1d1f; }
    .container { max-width:1200px; margin:auto; }
    .card { background:white; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.1); padding:20px; margin-bottom:20px; transition:transform 0.2s, box-shadow 0.2s; }
    .card:hover { transform:translateY(-4px); box-shadow:0 6px 25px rgba(0,0,0,0.15); }
    .card-header {
        position: relative;
        background-color: rgba(0,0,0,0.6);
        color:white;
        border-radius:12px;
        padding:30px;
        background-size: cover;
        background-position: center;
        overflow: hidden;
    }
    .card-header::before {
        content: "";
        position: absolute;
        inset: 0;
        background: inherit;
        opacity: 0.25;
        z-index: 0;
    }
    .card-header-content {
        position: relative;
        z-index: 1;
    }
    .title { font-size: 24px; font-weight:600; margin-bottom:10px; }
    .desc { font-size:16px; color:#eee; margin-bottom:10px; }
    .thumbnail { width:160px; border-radius:10px; margin-bottom:15px; display:block; }
    .register-btn {
        background: none;
        border: 2px solid;
        border-image: linear-gradient(90deg, #007aff, #9b59b6) 1;
        color: #007aff;
        padding:10px 20px;
        border-radius:12px;
        cursor:pointer;
        font-weight:500;
        transition: all 0.3s ease;
    }
    .register-btn:hover {
        background: linear-gradient(90deg, #007aff, #9b59b6);
        color:white;
    }
    .section-title { font-size:20px; font-weight:600; margin-top:20px; margin-bottom:10px; }
    .subcard { background:#f9f9fb; border-radius:12px; padding:15px; margin-top:10px; border-left:4px solid #007aff; }
    .nested-card { background:#fdfdfd; border-radius:10px; padding:12px; margin-top:8px; border-left:3px dotted #ccc; }
    .label {
        display:inline-block;
        padding:4px 8px;
        border-radius:8px;
        font-size:12px;
        font-weight:500;
        margin-right:5px;
        margin-top:5px;
    }
</style>
</head>
<body>
<div class="container">
    <div id="courseDetails"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("courseId");
    const courseDetailsContainer = document.getElementById("courseDetails");

    try {
        const response = await fetch(`your_api_url_here/${courseId}`);
        const json = await response.json();

        // Use the correct object (your API may send course, learningProgram, or certification)
        const data = json.course || json.learningProgram || json.certification || json.data;
        if (!data) throw new Error("Invalid structure");

        const lo = data;
        const attributes = lo.attributes || {};
        const bannerUrl = attributes.bannerUrl || '';
        const title = attributes.title || "Untitled";
        const desc = attributes.description || "No description available";
        const duration = attributes.duration || "N/A";
        const skills = attributes.skills || "N/A";
        const skillLevel = attributes.skillLevel || "N/A";
        const skillCredits = attributes.skillCredits || "N/A";

        let html = `
            <div class="card">
                <div class="card-header" style="background-image:url('${bannerUrl}')">
                    <div class="card-header-content">
                        <h2 class="title">${title}</h2>
                        <p class="desc">${desc}</p>
                    </div>
                </div>
                <img src="${bannerUrl}" alt="Thumbnail" class="thumbnail">
                <button class="register-btn">Register</button>
                <div class="section-title">Your Learning Journey for this learningObject</div>
                <p><b>Title:</b> ${title}</p>
                <p><b>Description:</b> ${desc}</p>
                <p><b>Duration:</b> ${duration} mins</p>
                <p><b>Skills:</b> ${skills}</p>
                <p><b>Skill Level:</b> ${skillLevel}</p>
                <p><b>Skill Credits:</b> ${skillCredits}</p>
        `;

        // Color-coded format labels
        const getFormatLabel = (contentType) => {
            const map = {
                'Interactive': '#9b59b6',
                'VIDEO': '#27ae60',
                'PDF': '#2980b9',
                'DOC': '#e67e22',
                'AUDIO': '#8e44ad',
                'HTML': '#16a085'
            };
            const color = map[contentType] || '#555';
            return `<span class="label" style="background:${color}20; color:${color}">${contentType}</span>`;
        };

        // Render nested resources (added fix for learningProgram/certification)
        const renderResources = (resources) => {
            if (!resources || !resources.length) return '';
            return resources.map(r => {
                const rType = (["CP","SCORM12","SCORM2004"].includes(r.contentType)) ? "Interactive" : (r.contentType || "N/A");
                const subRes = (r.resources && r.resources.length)
                    ? `<div class="nested-card"><b>Sub-Resources:</b>${r.resources.map(sub => {
                        const subType = (["CP","SCORM12","SCORM2004"].includes(sub.contentType)) ? "Interactive" : (sub.contentType || "N/A");
                        return `<div><b>${sub.name}</b> - ${sub.duration || 'N/A'} mins ${getFormatLabel(subType)}</div>`;
                    }).join('')}</div>` : '';
                return `
                    <div class="nested-card">
                        <b>${r.name}</b> - ${r.duration || 'N/A'} mins ${getFormatLabel(rType)}
                        ${subRes}
                    </div>
                `;
            }).join('');
        };

        // Recursive renderer for subLOs
        const renderLearningObjects = (los) => {
            if (!los || !los.length) return '';
            return los.map(loItem => {
                const attr = loItem.attributes || {};
                const typeLabel = loItem.type ? `<span class="label" style="background:#007aff20; color:#007aff;">${loItem.type}</span>` : '';
                const loResources = renderResources(loItem.resources || loItem.learningObjectResources);
                const subLos = loItem.subLos ? renderLearningObjects(loItem.subLos) : '';
                return `
                    <div class="subcard">
                        <b>${attr.title || "Untitled"}</b> ${typeLabel}<br>
                        <i>${attr.description || "No description"}</i><br>
                        Duration: ${attr.duration || 'N/A'} mins
                        ${loResources}
                        ${subLos}
                    </div>
                `;
            }).join('');
        };

        // Show sub learning objects (modules/courses)
        if (lo.subLos && lo.subLos.length > 0) {
            html += `<div class="section-title">Modules / Sub-Learning Objects</div>`;
            html += renderLearningObjects(lo.subLos);
        }

        html += `</div>`;
        courseDetailsContainer.innerHTML = html;

    } catch (err) {
        console.error(err);
        courseDetailsContainer.innerHTML = `<div class="card">Failed to load course details.</div>`;
    }
});
</script>
</body>
</html>
